\title{Chapter 10: Beyond Simple Mean-Variance}

\section*{10.1. Shortcomings of Naïve MVO}

Before introducing more complex optimizations, let's work through a simple example - maybe the simplest instance of the simplest optimization problem-to illustrate the implications of MVO. We have just two assets, with non-negative Sharpe Ratios $s_{1}, s_{2}$. Their returns have correlation $\rho$. The inverse of the covariance matrix is
$$
\mathbf{C}^{-1}=\frac{1}{1-\rho^{2}}\left[\begin{array}{cc}
1 & -\rho \\
-\rho & 1
\end{array}\right]
$$

So by Equation (9.6), the optimal volatility allocation is
$$
\begin{aligned}
& v_{1}^{\star}=\frac{\kappa}{1-\rho^{2}}\left(s_{1}-\rho s_{2}\right) \\
& v_{2}^{\star}=\frac{\kappa}{1-\rho^{2}}\left(s_{2}-\rho s_{1}\right)
\end{aligned}
$$

Where $\kappa>0$ is a parameter determined by the risk tolerance or by the constraint on maximum portfolio risk. If $s_{2} / s_{1}<\rho$, then we short asset 2 . Consider first
the case where $s_{2}=0$ and $\rho>0$. In this case, we always short the asset. Asset 2 acts as hedge. Shorting it is beneficial because a) it has no cost (zero expected return); b) it reduces the volatility of the portfolio, since it is positively correlated to asset 1. When the Sharpe Ratio of asset 2 is positive, then there is a cost to shorting. A short position in asset 2 reduces volatility, but in order to improve the Sharpe Ratio, the correlation $\rho$ must exceed the threshold $s_{2} / s_{1}$.

Even though the recommendation to short an asset with positive returns is explainable, it is probably at odds with the intuition of many readers. If two assets are very correlated, wouldn't it be preferable to go long both, thus averaging out the signal error? We can make this reasoning more rigorous by assessing the impact of estimation error on expected returns and on the correlation.

Impact of errors in forecasted Sharpe Ratios. We denote the true Sharpe Ratios $\tilde{s}_{i}$, and assume that the error between the true and forecasted Sharpe Ratios is bounded: $\|\tilde{\mathbf{s}}-\mathbf{s}\| \leq \epsilon$. We choose optimal dollar volatilities based on forecasted Sharpe Ratios $\mathbf{v}^{\star}$, and observe performance that is a function of $\tilde{\mathbf{s}}$. The realized expected return is
$$
E(\operatorname{PnL})=\frac{\kappa}{1-\rho^{2}}\left[\left(s_{1}-\rho s_{2}\right) \tilde{s}_{1}+\left(s_{2}-\rho s_{1}\right) \tilde{s}_{2}\right]
$$

In the worst case, we solve the problem
$$
\begin{aligned}
& \min E(\mathrm{PnL}) \\
& \text { s.t. }\|\tilde{\mathbf{s}}-\mathbf{s}\| \leq \epsilon \\
& \tilde{\mathbf{s}} \in \mathbb{R}^{2}
\end{aligned}
$$

I leave the solution as an exercise (also, see Insight 10.1); the relative reduction in PnL is
$$
-\frac{\sqrt{\left(s_{1}-\rho s_{2}\right)^{2}+\left(s_{2}-\rho s_{1}\right)^{2}}}{\left(s_{1}-\rho s_{2}\right) s_{1}+\left(s_{2}-\rho s_{1}\right) s_{2}} \epsilon
$$

This is also the relative loss in Sharpe, since the volatility of the portfolio is unaffected by return forecast error. Figure 10.1 shows numerical results for two assets, assuming an error $\epsilon=0.5$ and varying levels of correlation. An error of 0.5 is perhaps conservative; actual differences in forecasted versus realized Sharpe Ratios are higher. Notice that high correlation makes things worse. In all scenarios, the percentage in efficiency is significant. It is of course lower for higher Sharpes (because the relative forecasting error is smaller); and is higher for higher correlations. In all cases it exceeds $10 \%$ and can be as high as $50 \%$.
[WILEY EDITORS: place Figure 10.1 around here.]

![](https://cdn.mathpix.com/cropped/2024_12_20_1564b045dd40d185d12cg-356.jpg?height=1714&width=874&top_left_y=542&top_left_x=555)

Figure 10.1: Level plots of the loss of PnL (and Sharpe Ratio) as a function of the Sharpe Ratio of two assets, assuming a maximum error $\epsilon$ in the Sharpe Ratio norm. Parameters: $\epsilon=0.5$; Correlation: $\rho=0.1$ (top), $\rho=0.5$ (bottom).


Impact of errors in correlation among assets. We repeat the analysis, but allowing for error in the assets' correlation $\rho$. We denote the true correlation $\tilde{\rho}$ and assume that the estimation error is bounded: $|\tilde{\rho}-\rho| \leq \epsilon$. The error in estimated correlation affects the volatility; the expected expected return is not affected. The Sharpe Ratio is minimized when the realized volatility is maximized:
$$
\begin{gathered}
\max \left(\mathbf{V}^{\star}\right)^{\top} \tilde{\mathbf{C}} \mathbf{V}^{\star} \\
\text { s.t. }|\tilde{\rho}-\rho| \leq \epsilon \\
\rho \in \mathbb{R}
\end{gathered}
$$

In this case the worst-case realized relative volatility (exercise!) is
$$
\sqrt{\left(\mathbf{V}^{\star}\right)^{\top} \mathbf{C} \mathbf{V}^{\star}+2 \epsilon\left|v_{1}^{\star} v_{2}^{\star}\right|}
$$
and the associated relative loss in Sharpe Ratio is
$$
\sqrt{\frac{\left(\mathbf{V}^{\star}\right)^{\top} \mathbf{C} \mathbf{V}^{\star}}{\left(\mathbf{V}^{\star}\right)^{\top} \mathbf{C V}^{\star}+2 \epsilon\left|v_{1}^{\star} v_{2}^{\star}\right|}}-1
$$

We show the impact of the error in Figure 10.2, for a reasonable error in correlation estimate of 0.1 . However, in periods of crisis, the error can be larger (albeit not dramatically so). In Figure 10.3 I show the impact of correlation error on Sharpe.
[WILEY EDITORS: place Figure 10.2 around here.]
[WILEY EDITORS: place Figure 10.3 around here.]

![](https://cdn.mathpix.com/cropped/2024_12_20_1564b045dd40d185d12cg-358.jpg?height=1717&width=873&top_left_y=540&top_left_x=561)

Figure 10.2: Level plots of the loss of PnL (and Sharpe Ratio) as a function of the Sharpe Ratio of two assets, assuming a maximum error $\epsilon$ in the correlation. Parameters: $\epsilon=0.1$; Correlation: $\rho=0.1$ (top), $\rho=0.5$ (bottom).
![](https://cdn.mathpix.com/cropped/2024_12_20_1564b045dd40d185d12cg-359.jpg?height=782&width=866&top_left_y=1035&top_left_x=556)

Figure 10.3: fraction loss in Sharpe Ratio for two strategies with Sharpe Ratios of 3 and 2 , return correlation $\rho=0.3$, and error $\epsilon$ ranging from 0 to 0.3 .


\subsection*{Insight 10.1: A simple linear-quadratic problem}

Let $\mathbf{a}, \mathbf{x}_{0} \in \mathbb{R}^{n}$. The problem $\min \left\{\langle\mathbf{a}, \mathbf{x}\rangle \mid\left\|\mathbf{x}-\mathbf{x}_{0}\right\|^{2} \leq \epsilon^{2}\right\}$ has solution
$$
\begin{aligned}
\mathbf{x}^{\star} & =\mathbf{x}_{0}-\frac{\mathbf{a}}{\|\mathbf{a}\|} \epsilon \\
\frac{\left\langle\mathbf{a}, \mathbf{x}^{\star}\right\rangle}{\left\langle\mathbf{a}, \mathbf{x}_{0}\right\rangle}-1 & =-\frac{\|\mathbf{a}\|}{\left\langle\mathbf{a}, \mathbf{x}_{0}\right\rangle} \epsilon
\end{aligned}
$$

\subsection*{Insight 10.2: Degradation in performance due to forecasting error}
When we use Naïve MVO optimization, the degradation in Sharpe Ratio arising from forecasted (ex ante) parameters for volatilities and returns vs realized values (ex post) can easily range in the 10-50\%.

\section*{10.2. Constraints and Modified Objectives}

Equation (9.2) is the starting point for more complex optimization problems. They reflect the detailed preferences of the investors, short-term concerns, regulatory constraints, and implementation considerations. In applications, optimization formulations differ widely because they address a wide range of concerns:
- Investor's preferences: "Keep medium-term momentum exposure exactly equal to zero."
- Tactical considerations: "Don’t trade this stock because it could be acquired tomorrow" or "liquidate this stock because it could be acquired tomorrow"; both are valid, if incompatible, concerns.
- Regulatory considerations: "The portfolio must be long only".
- Fiduciary considerations: "The portfolio must track a benchmark, i.e., the difference in returns between the portfolio's returns and the benchmark's cannot exceed a certain tracking volatility".
- Implementation considerations: "The objective function must include the trading costs."

From a modeling viewpoint, constraints can take several forms. We introduce those first, and then we map them to the applications at hand. The "mapping" part will be either instructive if you have never been exposed to it, or terminally boring if you have worked in portfolio management for a few years. Rejoice with the former group, and commiserate with the latter.

\subsection*{10.2.1. Types of Constraints}

Although one can imagine infinite types of constraints, some of them are much more common than others. We review them below.
- Linear constraints. These can be inequality or equality constraints:
$$
\begin{array}{lr}
\mathbf{A}^{\top} \mathbf{w} \leq \mathbf{c} & \text { (Inequality constraints) }  \tag{10.1}\\
\mathbf{A}^{\top} \mathbf{w}=\mathbf{c} & \text { (Equality constraints) }
\end{array}
$$

These are perhaps the most common constraints in financial optimization, because they are used to address several of the concerns listed at the beginning of the section. For example, some strategies are required to be long-only. The constraint is simply
$$
\mathbf{w} \geq 0 \quad \text { (Long-Only constraint) }
$$

Extending this to a bound on maximum short and long size for a single position is only a small step. The rationales for such constraints are many. There are natural limits due to maximum institutional ownership of a stock (say, no more than $5 \%$ of the outstanding stocks); or to the maximum risk concentration in a stock: the idiosyncratic variance of a stock may not exceed a certain percentage of the total idiosyncratic variance, which translates to a linear constraint. Further still, we may impose a maximum liquidation cost requirement on all stocks; which also becomes a constraint on single position size.

A slightly more complex constraint, which does not seem linear at first sight, is on Gross Market Value: $\sum_{i}\left|w_{i}\right| \leq G$. This constraint may originate on
limits on financial leverage that the fund can apply to its managed assets. The constraint may be turned into a linear one ${ }^{1}$ by introducing ancillary variables representing the long and short side of a position, and additional constraints:
$$
\begin{align*}
\mathbf{x} & \geq 0 \quad \text { (GMV constraint) }  \tag{10.2}\\
\mathbf{y} & \geq 0  \tag{10.3}\\
\mathbf{w} & =\mathbf{x}-\mathbf{y}  \tag{10.4}\\
\sum_{i}\left(x_{i}+y_{i}\right) & \leq G \tag{10.5}
\end{align*}
$$

A similar constraint is on the long vs short ratio ${ }^{2}$. If we want the long/short ratio to be equal to a certain value, then the constraint is $\sum_{i} w_{i}^{+}=K \sum_{i} w_{i}^{-}$. This constraint is the same as the GMV constraint, with the exception of Equation (10.5), which we replace with
$$
\sum_{i} x_{i}=K \sum_{i} y_{i} \quad(\text { Long } / \text { Short ratio constraint })
$$

\footnotetext{
${ }^{1}$ Before rediscovering the wheel, know that some financial optimization packages abstract the modeling of the GMV constraint, so that you just have to specify it.
${ }^{2}$ For example a few years ago, 130/30 portfolios were popular. These strategies managed net-long portfolios, with a $30 \%$ of Net Market Value invested in shorts and $130 \%$ invested in longs
}

Yet another class of constraint is that on factor model exposures, and on exposures to other asset characteristics not in the model. An example is the constraint on historical market betas $\beta_{i}$. The constraint then is $\sum_{i} \beta_{i} w_{i}=b_{0}$. The general form of factor exposure is verbatim that of Equations (10.1).

A constraint on maximum portfolio turnover takes a similar form to the previous constraints that use absolute values. I am leaving it as an exercise to the reader. The turnover constraint may be either (poorly) justified to control costs, or by fiduciary requirements on portfolio turnover. A better way to model execution costs takes us in the domain of non-linear constraints.
- Non-linear constraints. A constraint of a different nature is trading-related. Trading occurs over many periods, and one approach to control excessive trading is to limit the traded capital, possibly weighted to account for assetspecific trading cost, in each portfolio rebalancing. This is equivalent to assuming linear transaction costs. We generalize this at little cost, and model trading costs as superlinear in traded amount but growing at a quadratic rate or less: $c_{i}\left|\Delta w_{i}\right|^{\gamma}$, where $\gamma \in[1,2]$. The constraint takes the form:
$$
\sum_{i} c_{i}\left|w_{i}-w_{i}^{\text {start }}\right|^{\gamma} \leq C \quad \text { (Trading cost constraint) }
$$
where $\mathbf{w}^{\text {start }}$ is the portfolio held at the beginning of the period. The constraint is convex, so that the portfolio optimization problem has a unique solution. Quadratic constraints appear naturally when we want to control risk at a finer resolution than that on total variance. For example, let $\boldsymbol{\Omega}_{\mathbf{f}}^{\text {style }}$ be the principal submatrix in the factor covariance matrix, and let $\mathbf{b}^{\text {style }}=\left(\mathbf{B}^{\text {style }}\right)^{\top} \mathbf{w}$ be the vector of style factor exposures. Then a constraint on the maximum style-factor risk becomes
$$
\begin{aligned}
\mathbf{b}^{\text {style }} & =\left(\mathbf{B}^{\text {style }}\right)^{\top} \mathbf{w} \\
\left(\mathbf{b}^{\text {style }}\right)^{\top} \boldsymbol{\Omega}_{\mathbf{f}}^{\text {style }} \mathbf{b}^{\text {style }} & \leq \sigma_{\text {style }}^{2} \quad(\text { Style factor vol constraint })
\end{aligned}
$$

Risk constraints are often not only applied to the positions of a portfolio, but to the active positions of the portfolio itself. For example, consider a
long-only portfolio with a GMV of $\$ 1 \mathrm{~B}$, and let $\mathrm{w}^{\text {bench }}$ be the positions of a portfolio with the same GMV, with weights proportional to those of the SP500 benchmark. The active holdings are $\mathbf{w}^{\mathbf{a}}=\mathbf{w}-\mathbf{w}^{\text {bench }}$. Tracking error is the volatility of the active portfolio, and is a measure of the freedom the portfolio manager has in selecting stocks. A constraint on the tracking error is
$$
\left(\mathbf{w}^{a}\right)^{\top} \boldsymbol{\Omega}_{\mathrm{r}} \mathbf{w}^{a} \leq \sigma_{a}^{2} \quad(\text { tracking error constraint) }
$$
- Non-convex constraints. Finally, there are a few constraint types that lead to a non-convex feasible region. Finding a global optimum is in general NP-hard. Convex solvers may either not accept such constraints ${ }^{3}$, or may not converge. I would argue that, in most cases, these constraints should not be used on grounds of sensible modeling. I am presenting them both for completeness and as a cautionary tale.

\footnotetext{
${ }^{3}$ Some solvers are able to understand from the description of the problem whether it is convex or not.
}

The first constraint type is on the maximum number $N_{\max }$ of assets in the portfolio. This is usually implemented by introducing $0 / 1$ variables $x_{i}$, and by setting a maximum (large) absolute position size $M$. The constraint becomes
$$
\begin{align*}
\left|w_{i}\right| & \leq M x_{i} \quad i=1, \ldots, n \quad \text { (Max number of positions) }  \tag{10.6}\\
\sum_{i=1}^{n} x_{i} & \leq N_{\max }  \tag{10.7}\\
x_{i} & \in\{0,1\} \quad i=1, \ldots, n \tag{10.8}
\end{align*}
$$

The rationale for this constraint is that a very broad portfolio may be too burdensome to trade or manage. This combinatorial constraint can be handled by some commercial solvers for realistic problem instances with thousands of assets. However, its utility is limited. It is usually preferable to model trading costs directly, and either not include a constraint at all, or have a threshold for trading below which the trades of the optimal solution are set to zero. This usually has a negligible impact on optimality.

A very different type of constraint is on the minimum idio variance as a percentage of the total variance. We have mentioned this metric in Section 4.5.2. It is tempting to include a constraint of the form
$$
\begin{equation*}
\mathbf{w}^{\top} \boldsymbol{\Omega}_{\epsilon} \mathbf{w} \geq p_{\mathrm{idio}} \mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w} \tag{10.9}
\end{equation*}
$$
or, equivalently,
$$
\begin{equation*}
\mathbf{w}^{\boldsymbol{\top}}\left[p_{\text {idio }} \mathbf{B} \boldsymbol{\Omega}_{\mathbf{f}} \mathbf{B}^{\boldsymbol{\top}}-\left(1-p_{\text {idio }}\right) \boldsymbol{\Omega}_{\boldsymbol{\epsilon}}\right] \mathbf{w} \leq 0 \tag{10.10}
\end{equation*}
$$

The problem is that the matrix $p_{\text {idio }} \mathbf{B} \boldsymbol{\Omega}_{\mathbf{f}} \mathbf{B}^{\boldsymbol{\top}}-\left(1-p_{\text {idio }}\right) \boldsymbol{\Omega}_{\boldsymbol{\epsilon}}$ is in general not positive definite, and therefore the constraint is not convex (exercise: prove it by providing an example).

A constraint type with a similar objective is to require a minimum idiosyncratic dollar volatility: $\mathbf{w}^{\boldsymbol{\top}} \boldsymbol{\Omega}_{\boldsymbol{\epsilon}} \mathbf{W} \geq \sigma_{\text {idio }}^{2}$. This is obviously a non-convex constraint, and its proponents should be excommunicated from the Orthodox Church of Optimization. A sensible approach is to simply upper bound the factor variance, or impose bounds of factor exposures, and test the impact of the bound on the portfolio's performance.

Yet another excommunicable offense is imposing a lower bound on total volatility. I would not mention it, had I not witnessed actual humans proposing it.

In the same spirit, i.e., the goal of ensuring that the portfolio meets a minimum size, is a lower bound on Gross Market Value. The answer to these constraints is that they are usually ill-conceived. If, after accounting for excess return forecasts, trading costs, and risk constraints, the optimal portfolio is small, then maybe it should stay small. And if one really wants to make it bigger (again, not advisable), one could loosen the upper bounds on risk or underestimate the transaction costs.

\subsection*{10.2.2. Do Constraints Improve or Worsen Performance?}

The naïve answer to the title of this section is that - of course!- they worsen performance. If you reduce the feasible region of your optimization problem by adding a constraint, you will not get a better optimum. Specifically, if we maximize the Sharpe Ratio, adding constraints will degrade the Sharpe Ratio ${ }^{4}$ This is true if the data in the problem, i.e. covariance matrix and expected returns, are estimated correctly. If we take estimation error into account, however, constraints may help. The next section interprets constraints as regularization terms for parameters entering in the optimization ${ }^{5}$.

\footnotetext{
${ }^{4}$ For example, see Clarke et al. [2002].
${ }^{5}$ The academic literature on this subject is not very large. See Jagannathan and Ma [2003] for an early contribution to the analysis of long-only constraints; The work by DeMiguel et al. [2009a,b] on trading penalties; Fan et al. [2012] on GMV constraints and Ceria et al. [2012], Saxena and Stubbs [2013] on penalties on the factor covariance matrix.
}

\subsection*{10.2.3. Constraints as Penalties}

One alternative way to interpret a constraint in portfolio optimization is as a penalty term added to the objective function: given a problem
$$
\begin{aligned}
& \max f(\mathrm{x}) \\
& \text { s.t. } g(\mathrm{x}) \leq a
\end{aligned}
$$
with optimal solution $\mathbf{x}^{\star}(a)$, there is a $\lambda^{\star}(a)>0$ such that
$$
\max f(\mathbf{x})-\lambda^{\star}(a) g(\mathbf{x})
$$
has the same solution $\mathbf{x}^{\star}(a)$. We used this result at the beginning of the chapter. The parameter $\lambda^{\star}(a)$ can also be interpreted as a sensitivity to the constraint's right-hand side parameter $a$. The variable $\lambda$ is the marginal change in the optimum when we increase (or "relax") $a: d f\left(\mathbf{x}^{\star}(a)\right) / d a=\lambda(a)$. Since a commercial solver returns both $\mathbf{x}^{\star}$ and $\lambda^{\star}$, this means that we get sensitivities at zero additional cost. This results also opens up a different modeling approach. What if we converted constraints into penalties? We now know that the outcome, for the appropriate penalizing coefficient, is the same. Does this mean that the approaches are equivalent? The answer is no, and the remainder of this section is devoted to illustrating the difference.

First, let us focus our attention on the meaning of constraints and penalties. There are constraints that are commensurable with the objective, and that are naturally expressed as penalties. For example, you could put a constraint on maximum trading costs. However, costs and expected PnL in the objective have the same unit (dollar) and it makes more sense to express the objective function as the difference of PnL and trading cost. The penalty parameter is simply one.

What about risk? If we fix the time interval, the variance constraint has the dimension of dollar squared, and is therefore not commensurable to PnL in the objective. What we could add to the objective function is $\sqrt{\mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w}}$. This is possible in some optimization packages ${ }^{6}$ However, if we know the approximate value $\sigma_{0}$ of final volatility, we can choose a penalty parameter such that the adding a volatility term or a variance one gives a similar result. We do so by linearizing in the region of the optimum portfolio:
$$
\begin{aligned}
-\lambda \sqrt{\sigma_{0}^{2}+\left(\mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w}-\sigma_{0}^{2}\right)} & \simeq-\frac{\lambda}{\sigma_{0}}\left(\mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w}-\sigma_{0}^{2}\right) \\
& =\lambda \sigma_{0}-\tilde{\lambda} \mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w} \\
\tilde{\lambda} & :=\frac{\lambda}{\sigma_{0}}
\end{aligned}
$$

\footnotetext{
${ }^{6} \mathrm{~A}$ volatility constraint or penalty is in practice computationally more burdensome to solve than a variance constraint or penalty.
}

The constant term is irrelevant to the optimization problem, and the volatility is locally approximated by a variance.

A second class of constraints does not have an obvious interpretation. Should we add the constraint on GMV as a penalty? Or long-only constraints? The answer, somewhat surprisingly, is that adding those constraints as penalty may actually help the performance of the optimized portfolio, when the parameters in the model are not accurately estimated.

Let us start with an augmented version of Problem (9.8):
$$
\begin{gather*}
\max \boldsymbol{\alpha}^{\top} \mathbf{w}-\lambda \mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w}  \tag{10.11}\\
\text { s.t. }\|\mathbf{w}\|^{2} \leq G
\end{gather*}
$$
whose penalized version is
$$
\begin{equation*}
\max \boldsymbol{\alpha}^{\top} \mathbf{w}-\lambda \mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w}-\nu\|\mathbf{w}\|^{2} \tag{10.12}
\end{equation*}
$$

This problem can interpreted in many different ways. The first one is a simple rewriting of the quadratic terms as $\lambda \mathbf{w}^{\boldsymbol{\top}}\left(\boldsymbol{\Omega}_{\mathbf{r}}+(\nu / \lambda) \mathbf{I}_{n}\right) \mathbf{w}=: \mathbf{w}^{\boldsymbol{\top}} \tilde{\boldsymbol{\Omega}}_{\mathbf{r}} \mathbf{w}$. The problem then is a MVO with a modified covariance matrix. The correlations of the original covariance matrix have been reduced by a factor $\lambda /(\lambda+\nu)$. The asset variances have been increased, and are more similar to each other; in the limit $\nu \rightarrow \infty$ they are identical. The norm constraint therefore has a "regularizing" effect on the solution. There are different optimization formulations that leads to the same solution of the optimization problem (10.12).
1. Uncertain alpha [Stubbs and Vance, 2005]. Let us start with the assumption that the vector $\boldsymbol{\alpha}$ is not known with accuracy. We make the assumption that the vector is distributed according to a multivariate Gaussian: $\boldsymbol{\alpha} \sim N\left(\boldsymbol{\alpha}_{0}, \tau^{2} \mathbf{I}_{n}\right)$. We still solve a MVO, taking into account alpha uncertainty:
$$
\operatorname{var}\left(\mathbf{r}^{\top} \mathbf{w}\right)=\operatorname{var}\left(\boldsymbol{\alpha}^{\top} \mathbf{w}\right)+\operatorname{var}\left[(\mathbf{r}-\boldsymbol{\alpha})^{\top} \mathbf{w}\right]=\mathbf{w}^{\top}\left(\tau^{2} \mathbf{I}_{n}+\boldsymbol{\Omega}_{\mathbf{r}}\right) \mathbf{w}
$$
The MVO formulation is again the same as that of Equation (9.8), but with a modified covariance matrix. As in the case of Equation (10.12), the variances are made more equal, and correlations are shrunk toward zero.

2. Robust alpha [Pedersen et al., 2021]. Instead of modeling alphas' imperfect estimation by assuming that we know their distribution, we model their error deterministically, and adversarially: we know that the true alphas
are within a certain distance $d$ from our estimate and, as we did at the beginning of the chapter, we look at the worst case, i.e., the realized alpha is the worst possible one among the admissible realizations. In formulas, we solve
$$
\begin{align*}
& \max \mathbf{a}^{\top} \mathbf{w}-\lambda \mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w}  \tag{10.13}\\
& \text { s.t. } \mathbf{a}=\arg \min _{\mathbf{x}}\left\{\mathbf{x}^{\top} \mathbf{w}\|\mid \mathbf{x}-\boldsymbol{\alpha}\| \leq d\right\} \tag{10.14}
\end{align*}
$$
We know what the solution to the nested problem (10.14): from Insight 10.1, it is equal to $\mathbf{a}=\boldsymbol{\alpha}-d \mathbf{w} /\|\mathbf{w}\|$. Hence we solve
$$
\begin{equation*}
\max \boldsymbol{\alpha}^{\top} \mathbf{w}-\lambda \mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w}-d\|\mathbf{w}\| \tag{10.15}
\end{equation*}
$$
This is similar, but not identical, to Equation (10.12): the norm penalty term is not squared. The same argument can be made to show that the norm and the norm squared are interchangeable, once the penalty constant $d$ is rescaled: $d\|\mathbf{w}\| \simeq\left(d /\left\|\mathbf{w}_{0}\right\|\right)\|\mathbf{w}\|^{2}$, for a $\left\|\mathbf{w}_{0}\right\|$ close to $\|\mathbf{w}\|$ of the final solution.

3. Robust factors [Ceria et al., 2012]. We consider another instance of constrained optimization. A recurrent theme in this book is model misspecification. Factor models can be misspecified (both in their factor structure and in their expected returns), but they also offer remedies. Consider the case of an omitted factor. As a special case of misspecification, its effect is to worsen the Sharpe Ratio of the MVO portfolio. In order to reduce the impact, let us consider again an adversarial approach. Assume that there is a hidden factor, whose loadings we do not know, but whose volatility $\tau$ is given. We use this as a parameter to quantify the importance of the
omitted factor.
The new factor model includes an additional factor loading $\mathbf{v}$ orthogonal to $\mathbf{B}$. The covariance matrix is
$$
\tilde{\boldsymbol{\Omega}}_{\mathrm{r}}=\boldsymbol{\Omega}_{\mathrm{r}}+\tau^{2} \mathbf{v v}^{\top}
$$

We solve
$$
\begin{aligned}
\max _{\mathbf{w}} & \min _{\|\mathbf{v}\| \leq 1} \boldsymbol{\alpha}^{\top} \mathbf{w}-\lambda \mathbf{w}^{\top}\left(\boldsymbol{\Omega}_{\mathbf{r}}+\tau^{2} \mathbf{v} \mathbf{v}^{\top}\right) \mathbf{w} \\
& \max _{\mathbf{w}} \boldsymbol{\alpha}^{\top} \mathbf{w}-\lambda \mathbf{w}^{\top}\left(\boldsymbol{\Omega}_{\mathbf{r}}+\frac{\tau^{2}}{\|\mathbf{w}\|^{2}} \mathbf{w w}^{\boldsymbol{\top}}\right) \mathbf{w} \\
& \max _{\mathbf{w}} \boldsymbol{\alpha}^{\top} \mathbf{w}-\lambda \mathbf{w}^{\top}\left(\boldsymbol{\Omega}_{\mathbf{r}}+\tau^{2} \mathbf{I}_{n}\right) \mathbf{w}
\end{aligned}
$$

So, yet again, we are solving an optimization problem with a penalized covariance matrix.
4. Robust asset correlations [Boyd et al., 2016]. Here we have another case of adversarial modeling that is expressed as a penalization term. Assume that we estimate the asset correlation matrix terms with some error independent of the asset pair, so that the difference between the estimated correlation and the true correlation is at most $\left|\rho_{i, j}-\hat{\rho}_{i, j}\right| \leq d$. The adversarial model looks for a solution to the MVO problem, where Nature chooses the covariance matrix with the highest variance compatible with the error bound:
$$
\begin{align*}
\max & \mathbf{a}^{\top} \mathbf{w}-  \tag{10.16}\\
\lambda & \sigma^{2}  \tag{10.17}\\
\text { s.t. } \sigma^{2}(\mathbf{w})= & \arg \max _{\Delta \in \mathbb{R}^{n \times n}} \mathbf{w}^{\top}\left(\boldsymbol{\Omega}_{\mathbf{r}}+\boldsymbol{\Delta}\right) \mathbf{w}  \tag{10.18}\\
& \text { s.t. }\left|[\boldsymbol{\Delta}]_{i, j}\right| \leq d \sqrt{[\boldsymbol{\Omega}]_{i, i}[\boldsymbol{\Omega}]_{j, j}}, i, j=1, \ldots, n
\end{align*}
$$

The objective of the nested problem is equivalent to
$$
\begin{equation*}
\mathbf{w}^{\top} \boldsymbol{\Delta} \mathbf{w}=\sum_{i, j} w_{i} w_{j} \sqrt{[\boldsymbol{\Omega}]_{i, i}[\boldsymbol{\Omega}]_{j, j}} \rho_{i, j} \tag{10.19}
\end{equation*}
$$

Every term is maximized when $\rho_{i, j}=d \times \operatorname{sgn}\left(w_{i} w_{j}\right)$, and the objective function value is
$$
\begin{align*}
\left(\mathbf{w}^{\star}\right)^{\top} \boldsymbol{\Delta} \mathbf{w}^{\star} & =d \sum_{i, j}\left|w_{i} w_{j}\right| \sqrt{[\boldsymbol{\Omega}]_{i, i}[\boldsymbol{\Omega}]_{j, j}}  \tag{10.20}\\
& =d\left(\sum_{i}\left|w_{i}\right| \sqrt{[\boldsymbol{\Omega}]_{i, i}}\right)  \tag{10.21}\\
& =d\|\mathbf{V} \mathbf{w}\|_{1}^{2} \tag{10.22}
\end{align*}
$$

Where $\mathbf{V}$ is a diagonal covariance matrix whose $i$ th diagonal term is the volatility of asset $i$. Let us plug this back in the original problem:
$$
\begin{equation*}
\max \mathbf{a}^{\top} \mathbf{w}-\lambda \mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w}-\lambda d\|\mathbf{V} \mathbf{w}\|_{1}^{2} \tag{10.23}
\end{equation*}
$$

And we have yet again a penalization term, which is, in this case, the square of an L1 norm of the portfolio weights. The function $\|\mathbf{V w}\|_{1}^{2}$ is convex, so the optimization problem is tractable. I am summarizing the penalization approaches in the table below.
5. Robust covariance matrix [Ledoit and Wolf, 2004]. Consider a different starting point to model robust covariance optimization. We assume that the adversary has a budget for the maximum cumulative squared error of the asset covariances: $\sum_{i, j}[\boldsymbol{\Delta}]_{i, j}^{2} \leq d^{2}$. This is the same as a bound on the Frobenius norm of the error, $\|\boldsymbol{\Delta}\|_{F}$. The robust problem formulation
is similar to the previous one:
$$
\begin{aligned}
& \max \mathbf{a}^{\top} \mathbf{w}-\lambda \mathbf{w}^{\top} \boldsymbol{\Omega}_{\mathbf{r}} \mathbf{w}-\lambda \sigma^{2} \\
& \text { s.t. } \sigma^{2}=\arg \max _{\Delta}\left\{\mathbf{w}^{\top} \boldsymbol{\Delta} \mathbf{w} \mid\|\boldsymbol{\Delta}\|_{F}^{2} \leq d^{2}\right\}
\end{aligned}
$$

The strategy to solve this problem is similar to previous cases: the adversary maximizes a linear objective function with a norm constraint; see Insight 10.1 for the solution. In this case, $\left(\sigma^{\star}\right)^{2}=d\|\mathbf{w}\|^{2}$, yet again, and the problem becomes an MVO with a quadratic penalization term.
\begin{tabular}{lll}
\hline Approach & Penalty & Parameter Interpretation \\
\hline Uncertain Alpha & $\tau^{2}\|\mathbf{w}\|^{2}$ & std.error of $\hat{\boldsymbol{\alpha}}$ \\
Robust Alpha & $d\|\mathbf{w}\|$ & max distance $\|\boldsymbol{\alpha}-\hat{\boldsymbol{\alpha}}\|$ \\
Robust Factor & $\lambda \tau^{2}\|\mathbf{w}\|^{2}$ & volatility of a missing factor \\
Robust Correlations & $\lambda d\|\mathbf{V} \mathbf{w}\|_{1}^{2}$ & max distance $\left|\rho_{i, j}-\hat{\rho}_{i, j}\right|$ \\
Robust Covariance & $\lambda d\|\mathbf{w}\|^{2}$ & max distance $\left\|\boldsymbol{\Omega}_{\mathbf{r}}-\hat{\boldsymbol{\Omega}} \hat{\mathbf{r}}_{\mathbf{r}}\right\|$ \\
\hline
\end{tabular}

Exercise 10.1: (30) Define the norm $\|\mathbf{x}\|_{\boldsymbol{\Lambda}, p}:=\left\|\boldsymbol{\Lambda}^{-1} \mathbf{x}\right\|_{p}$. Extend Problem (10.12) to this norm. Read [Olivares-Nadal and DeMiguel, 2018] for additional interpretations of this penalty, and discuss their applicability to real-world settings.

\subsection*{Insight 10.3: The distinction between constraints and penalties}

Although they can yield the same optimal portfolio, the constrained and penalty version differ in two important ways. The first one is that the shadow price of the constraint is not known before the optimization is run. This means that the solution can be very sensitive to the choice of the right-hand side of the constraint: we don't know the trade-off between constraint limit and optimum value. This is not the case with a penalty: we set the price, and the price has often a straightforward interpretation (like the price for risk). In successive optimizations, this price is unchanged making comparisons easier. When the interpretation is clear, penalties are preferable. The second difference is almost a corollary of the first one: in the constrained formulation, we may have no feasible solution, which is, in a loose sense, like saying that the price of the constraint is infinite. This is never the case with a penalized formulation, which is always feasible.

\section*{10.3. How Does Estimation Error Affect Sharpe Ratio?}

An investor starts with estimates of expected returns and of the covariance matrix ${ }^{7}$. We denote them with $\hat{\boldsymbol{\alpha}}$ and $\hat{\boldsymbol{\Omega}}_{\mathbf{r}}$ respectively. The MVO portfolio is proportional to $\hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \hat{\boldsymbol{\alpha}}$; the proportionality constant is irrelevant for the Sharpe Ratio. The realized Sharpe Ratio, however, is a function of the true expected returns and covariance matrix $\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathrm{r}}$ :
$$
\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathrm{r}}\right)=\frac{\boldsymbol{\alpha}^{\top}\left(\hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \hat{\boldsymbol{\alpha}}\right)}{\sqrt{\left(\hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \hat{\boldsymbol{\alpha}}\right)^{\top} \boldsymbol{\Omega}_{\mathbf{r}}\left(\hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \hat{\boldsymbol{\alpha}}\right)}}
$$

\footnotetext{
${ }^{7}$ The third leg of the trading stool is a model for trading cost. We will cover this in later chapters
}

We compare the realized Sharpe Ratio to the best Sharpe ratio, based on the true values of $\boldsymbol{\alpha}$ and $\boldsymbol{\Omega}_{\mathbf{r}}$, given by Equation (9.5):
$$
\frac{\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathbf{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathbf{r}}\right)}
$$

We call this the Sharpe Ratio Efficiency (SRE) . It is important to study this quantity, because we want to know, at all times, whether we are losing a great deal of performance from inaccurate parameter estimation or large transaction costs. We will ask a few qualitative and quantitative questions, and see how far can the analysis take us ${ }^{8}$.

First, we prove an intuitive fact: incorrect estimates worsen performance.

Theorem 10.1: The Sharpe Ratio Efficiency is less or equal than one, and if it equal to one if and only if $\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \boldsymbol{\alpha}$ and $\boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2} \hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \hat{\boldsymbol{\alpha}}$ are collinear.

Proof. The SRE is
$$
\begin{equation*}
\frac{\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathrm{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathrm{r}}\right)}=\frac{\boldsymbol{\alpha}^{\top} \hat{\boldsymbol{\Omega}}_{\mathrm{r}}^{-1} \hat{\boldsymbol{\alpha}}}{\sqrt{\hat{\boldsymbol{\alpha}}^{\top} \hat{\boldsymbol{\Omega}}_{\mathrm{r}}^{-1} \boldsymbol{\Omega}_{\mathrm{r}} \hat{\boldsymbol{\Omega}}_{\mathrm{r}}^{-1} \hat{\boldsymbol{\alpha}}}} \frac{1}{\sqrt{\boldsymbol{\alpha}^{\top} \boldsymbol{\Omega}_{\mathrm{r}}^{-1} \boldsymbol{\alpha}}} \tag{10.24}
\end{equation*}
$$

Let ${ }^{9}$
$$
\begin{align*}
& \mathrm{a}:=\boldsymbol{\Omega}_{\mathrm{r}}^{-1 / 2} \boldsymbol{\alpha}  \tag{10.25}\\
& \mathbf{b}:=\boldsymbol{\Omega}_{\mathrm{r}}^{1 / 2} \hat{\boldsymbol{\Omega}}_{\mathrm{r}}^{-1} \hat{\boldsymbol{\alpha}} \tag{10.26}
\end{align*}
$$

\footnotetext{
${ }^{8}$ Early papers on model estimation error, and the relative impact of alpha and estimation error, are Michaud [1989], Shephard [2009], Chopra and W.Ziemba [1993].
${ }^{9}$ Let $\mathbf{H}$ be a symmetric positive definite matrix and let $\mathbf{V} \boldsymbol{\Lambda} \mathbf{V}^{\top}$ be its Singular Value Decomposition. Define $\mathbf{H}^{1 / 2}:=\mathbf{V} \boldsymbol{\Lambda}^{1 / 2} \mathbf{V}^{\top}$. Then $\mathbf{H}^{1 / 2} \mathbf{H}^{1 / 2}=\mathbf{H}$ and $\left\|\mathbf{H}^{1 / 2}\right\|_{\mathrm{op}}^{2}=\|\mathbf{H}\|_{\mathrm{op}}$.
}
so that
$$
\frac{\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathbf{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathbf{r}}\right)}=\frac{\mathbf{a}^{\top} \mathbf{b}}{\|\mathbf{a}\|\|\mathbf{b}\|}
$$

The Sharpe Ratio efficiency is always less than one because of Cauchy-Schwartz inequality ${ }^{10}$, unless $\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \boldsymbol{\alpha}$ and $\boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2} \hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \hat{\boldsymbol{\alpha}}$ are collinear.


\footnotetext{
${ }^{10}$ Which can be found in almost any linear algebra book. If $\mathbf{x}, \mathbf{y} \in \mathbb{R}^{n}$, then $\left|\mathbf{a}^{\top} \mathbf{b}\right| \leq$ $\sqrt{\mathbf{a}^{\top} \mathbf{a}} \sqrt{\mathbf{b}^{\top} \mathbf{b}}$, with the equality holding only if $\mathbf{a}=\kappa \mathbf{b}$.
}

\subsection*{10.3.1. The Impact of Alpha Error}

It is more useful to derive lower bounds on performance inefficiency, based on the estimation error of either expected returns of covariance.

We need to introduce a few basic results. Let the norm of a matrix be defined as the operator norm. Define the relative alpha error as
$$
\left\|\frac{\boldsymbol{\alpha}}{\|\boldsymbol{\alpha}\|}-\frac{\hat{\boldsymbol{\alpha}}}{\|\hat{\boldsymbol{\alpha}}\|}\right\| \leq \delta_{\mathrm{alpha}}
$$

In the Appendix (Section 10.4.1) I prove the following result:
$$
\frac{\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathbf{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathbf{r}}\right)} \geq 1-2\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{-1}\right\|\left\|\boldsymbol{\Omega}_{\mathbf{r}}\right\| \delta_{\text {alpha }}^{2}
$$

\subsection*{10.3.2. The Impact of Risk Error}

If there is $\kappa>0$ such that
$$
\begin{equation*}
\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2} \hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2}-\kappa \mathbf{I}\right\| \leq \delta_{\text {risk }} \tag{10.27}
\end{equation*}
$$

Then
$$
\begin{equation*}
\frac{\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathbf{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathbf{r}}\right)} \geq 1-\frac{2 \delta_{\text {risk }}}{\kappa+\delta_{\text {risk }}} \tag{10.28}
\end{equation*}
$$

This formula follows directly from the Equation (10.24). At first sight, what is interesting about this result is how weak it is. Let us consider a few special cases. We define $\mathbf{H}:=\boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2} \hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2}$.
1. If the estimated covariance matrix is biased, but uniformly so, i.e., $\hat{\boldsymbol{\Omega}}_{\mathbf{r}}=$ $\kappa \boldsymbol{\Omega}_{\mathbf{r}}$, then $\mathbf{H}=\kappa^{-1} \mathbf{I}$, and there is no efficiency loss. We knew this already from the previous chapter. What happens in practice is that we would deploy a portfolio with the highest Sharpe Ratio, but incorrect volatility.

2. Say, however, that we really estimate the covariance matrix incorrectly, so that $\mathbf{H} \not \propto \mathbf{I}$. It can still happen that we have a SRE of one! This will happen if $\hat{\boldsymbol{\alpha}}$ is proportional to an eigenvector of $\mathbf{H}$ with a positive eigenvalue. Say the associated eigenvalue is $\gamma$. Then, use directly Equation
$$
\begin{equation*}
\operatorname{SRE}=\frac{\hat{\boldsymbol{\alpha}}^{\top}(\gamma \hat{\boldsymbol{\alpha}})}{\|\hat{\boldsymbol{\alpha}}\|^{2}} \sqrt{\frac{\|\hat{\boldsymbol{\alpha}}\|^{2}}{\hat{\boldsymbol{\alpha}}^{\top}\left(\gamma^{2} \hat{\boldsymbol{\alpha}}\right)}}=\operatorname{sgn}(\gamma) \tag{10.24}
\end{equation*}
$$
Even more pathologically, though, this also implies that if our $\hat{\boldsymbol{\alpha}}$ is proportional to an eigenvector with negative eigenvalue, then the Sharpe Ratio Efficiency is -1. Incidentally, $\mathbf{H}$ is neither necessarily symmetric nor positive definite, so a negative eigenvalue is indeed a possibility.

3. But, you may argue, this is an exceptional circumstance. Consider a simpler but instructive case. We make the assumption that $\hat{\boldsymbol{\Omega}}_{\mathrm{r}}$ has the same eigenvectors as $\boldsymbol{\Omega}_{\mathrm{r}}$. In other words, the Singular Value Decompositions
only differ because of the Singular Values.
$$
\begin{aligned}
& \Omega_{\mathrm{r}}=\mathbf{U} \boldsymbol{\Lambda} \mathbf{U}^{\top} \\
& \hat{\Omega}_{\mathrm{r}}=\mathbf{U} \hat{\boldsymbol{\Lambda}} \mathbf{U}^{\top}
\end{aligned}
$$
so that $\mathbf{H}=\mathbf{U} \boldsymbol{\Lambda}^{1 / 2} \mathbf{U}^{\top} \mathbf{U} \hat{\boldsymbol{\Lambda}}^{-1} \mathbf{U}^{\top} \mathbf{U} \boldsymbol{\Lambda}^{1 / 2} \mathbf{U}^{\boldsymbol{\top}}=\mathbf{U} \boldsymbol{\Lambda} \hat{\boldsymbol{\Lambda}}^{-1} \mathbf{U}^{\top}$; a great simplification. Denote the eigenvalue ratio $\nu_{i}:=\lambda_{i} / \hat{\lambda}_{i}$. What is the lower bound on the SRE in this case? We solve for $\kappa$ :
$$
\begin{aligned}
\delta & :=\min _{\kappa}\left\|\mathbf{U}\left(\boldsymbol{\Lambda} \hat{\boldsymbol{\Lambda}}^{-1}-\kappa \mathbf{I}\right) \mathbf{U}^{\top}\right\| \\
& =\min _{\kappa} \sqrt{\max _{i}\left(\nu_{i}-\kappa\right)^{2}} \\
& =\frac{1}{2}\left(\max _{i} \nu_{i}-\min _{i} \nu_{i}\right)
\end{aligned}
$$
and the optimal point is $\kappa^{\star}=\left(\max _{i} \nu_{i}+\min _{i} \nu_{i}\right) / 2$. We use these values in Equation (10.28) to obtain
$$
\mathrm{SRE} \geq 1-\frac{\max _{i} \nu_{i}-\min _{i} \nu_{i}}{\max _{i} \nu_{i}}=\frac{\min _{i} \nu_{i}}{\max _{i} \nu_{i}}
$$

Hence the loss in efficiency arises from the fact that we estimate unevenly the volatilities of the eigenvectors of the asset covariance matrix. If we underestimate them (or overestimate them) by the same constant, then we lose nothing, as noted in the first point above. Let us think of an adverse case. Say we estimate all volatilities exactly $\left(\nu_{i}=1\right)$ except for one, which we underestimate by $50 \%$. Then the worst-case loss in Sharpe Ratio can be in $50 \%$.

\section*{10.4. ×Appendix}

\subsection*{10.4.1. Theorems on Sharpe Efficiency Loss}

These theorems are informally introduced in Section 10.3.
We recall that
$$
\left\|\mathbf{H}^{-1}\right\|^{-1}\|\mathbf{x}\| \leq\|\mathbf{H} \mathbf{x}\| \leq\|\mathbf{H}\|\|\mathbf{x}\|
$$
and
$$
\|\mathbf{H y}\| \leq\|\mathbf{H x}\|+\|\mathbf{H}(\mathbf{y}-\mathbf{x})\| \leq\|\mathbf{H} \mathbf{x}\|+\|\mathbf{H}\|\|\mathbf{x}-\mathbf{y}\|
$$
so that
$$
|\|\mathbf{H} \mathbf{x}\|-\|\mathbf{H y}\|| \leq\|\mathbf{H}\|\|\mathbf{x}-\mathbf{y}\|
$$

Also, use the cosine rule:
$$
\begin{aligned}
\left\|\frac{\mathbf{a}}{\|\mathbf{a}\|}-\frac{\mathbf{b}}{\|\mathbf{b}\|}\right\|^{2} & =2\left(1-\frac{\mathbf{a}^{\top} \mathbf{b}}{\|\mathbf{a}\|\|\mathbf{b}\|}\right) \\
\Rightarrow \frac{\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathbf{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathbf{r}}\right)} & =\frac{\mathbf{a}^{\top} \mathbf{b}}{\|\mathbf{a}\|\|\mathbf{b}\|} \\
& =1-\frac{1}{2}\left\|\frac{\mathbf{a}}{\|\mathbf{a}\|}-\frac{\mathbf{b}}{\|\mathbf{b}\|}\right\|^{2}
\end{aligned}
$$
where $\mathbf{a}, \mathbf{b}$ are defined by Equations (10.25) and (10.26).

Lemma 10.1: Let $\mathbf{H}$ be symmetric positive-definite, $\mathbf{x}, \mathbf{y} \in \mathbb{R}^{n}$, and
$$
\left\|\frac{\mathbf{x}}{\|\mathbf{x}\|}-\frac{\mathbf{y}}{\|\mathbf{y}\|}\right\| \leq \delta
$$

Then
$$
\left\|\frac{\mathbf{H x}}{\|\mathbf{H x}\|}-\frac{\mathbf{H y}}{\|\mathbf{H y}\|}\right\| \leq 2 \min \left\{\|\mathbf{H}\|\left\|\mathbf{H}^{-1}\right\| \delta, 1\right\}
$$

Proof. Let $\mathbf{a}, \mathbf{b} \in \mathbb{R}^{n}$.
$$
\begin{aligned}
\left\|\frac{\mathbf{H a}}{\|\mathbf{H a}\|}-\frac{\mathbf{H b}}{\|\mathbf{H b}\|}\right\| & =\left\|\frac{\|\mathbf{H b}\| \mathbf{H a}-\|\mathbf{H a}\| \mathbf{H b}}{\|\mathbf{H a}\|\|\mathbf{H b}\|}\right\| \\
& =\left\|\frac{\|\mathbf{H b}\| \mathbf{H}(\mathbf{a}-\mathbf{b})-(\|\mathbf{H a}\|-\|\mathbf{H b}\|) \mathbf{H b} \|}{\|\mathbf{H a}\|\|\mathbf{H b}\|}\right\| \\
& \leq \frac{1}{\|\mathbf{H a}\|}(\|\mathbf{H}(\mathbf{a}-\mathbf{b})\|+|\|\mathbf{H a}\|-\|\mathbf{H b}\||) \\
& \leq \frac{1}{\|\mathbf{H a}\|}(\|\mathbf{H}(\mathbf{a}-\mathbf{b})\|+\|\mathbf{H}\|\|\mathbf{a}-\mathbf{b}\|) \\
& \leq \frac{1}{\|\mathbf{H a}\|}(\|\mathbf{H}\|\|(\mathbf{a}-\mathbf{b})\|+\|\mathbf{H}\|\|\mathbf{a}-\mathbf{b}\|) \\
& =\frac{2}{\|\mathbf{H a}\|}\|\mathbf{H}\|\|(\mathbf{a}-\mathbf{b})\| \\
\left(\mathbf{a}:=\frac{\mathbf{x}}{\|\mathbf{x}\|}, \mathbf{b}:=\frac{\mathbf{y}}{\|\mathbf{y}\|}\right) & =\frac{2}{\left\|\mathbf{H} \frac{\mathbf{x}}{\|\mathbf{x}\|}\right\|}\|\mathbf{H}\|\left\|\frac{\mathbf{x}}{\|\mathbf{x}\|}-\frac{\mathbf{y}}{\|\mathbf{y}\|}\right\| \\
& \leq 2\|\mathbf{H}\|\left\|\mathbf{H}^{-1}\right\| \delta
\end{aligned}
$$

This bound is tight, up to a constant. For an example, consider the case of diagonal ${ }^{11} \mathbf{H}:=\operatorname{diag}\left(\lambda_{1}, \ldots, \lambda_{n}\right), \mathbf{x}:=\epsilon \mathbf{e}_{1}+\mathbf{e}_{n}, \mathbf{y}:=\mathbf{e}_{n}$, with $\epsilon \leq \lambda_{n} / \lambda_{1}$. 

\footnotetext{
${ }^{11}$ We use the notation $\mathbf{e}_{1}, \ldots, \mathbf{e}_{n}$ for the standard basis in $\mathbb{R}^{n}$.
}
We have
$$
\left\|\frac{\mathbf{x}}{\|\mathbf{x}\|}-\frac{\mathbf{y}}{\|\mathbf{y}\|}\right\| \leq \sqrt{\frac{3}{2}} \epsilon=: \delta
$$

$$
\begin{aligned}
\left\|\frac{\mathbf{H x}}{\|\mathbf{H x}\|}-\frac{\mathbf{H y}}{\|\mathbf{H y}\|}\right\| & =\left\|\frac{\lambda_{n} \mathbf{e}_{n}+\epsilon \lambda_{1} \mathbf{e}_{1}}{\sqrt{\lambda_{n}^{2}+\epsilon^{2} \lambda_{1}^{2}}}-\mathbf{e}_{n}\right\| \\
& =\sqrt{\left(\frac{\lambda_{n}}{\sqrt{\lambda_{n}^{2}+\epsilon^{2} \lambda_{1}^{2}}}-1\right)^{2}+\frac{\left(\epsilon \lambda_{1}\right)^{2}}{\lambda_{n}^{2}+\epsilon^{2} \lambda_{1}^{2}}} \\
& \geq \sqrt{2 \frac{-\lambda_{n}^{2}\left(\epsilon \lambda_{1} / \lambda_{n}\right)^{2} / 2+\left(\epsilon \lambda_{1}\right)^{2}}{\lambda_{n}^{2}+\left(\epsilon \lambda_{1}\right)^{2}}} \\
& \geq \sqrt{\frac{\left(\epsilon \lambda_{1}\right)^{2}}{\lambda_{n}^{2}+\left(\epsilon \lambda_{1}\right)^{2}}} \\
& \geq \frac{1}{\sqrt{2}} \frac{\lambda_{1}}{\lambda_{n}} \epsilon \\
& =\frac{1}{\sqrt{3}}\|\mathbf{H}\|\left\|\mathbf{H}^{-1}\right\| \delta
\end{aligned}
$$

Theorem 10.2(Misspecification of alpha): If
$$
\left\|\frac{\boldsymbol{\alpha}}{\|\boldsymbol{\alpha}\|}-\frac{\hat{\boldsymbol{\alpha}}}{\|\hat{\boldsymbol{\alpha}}\|}\right\| \leq \delta
$$

Then
$$
\frac{\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathbf{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathbf{r}}\right)} \geq 1-2\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{-1}\right\|\left\|\boldsymbol{\Omega}_{\mathbf{r}}\right\| \delta^{2}
$$

Proof. From Lemma 10.1:
$$
\begin{aligned}
\left\|\frac{\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \boldsymbol{\alpha}}{\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \boldsymbol{\alpha}\right\|}-\frac{\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \hat{\boldsymbol{\alpha}}}{\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \hat{\boldsymbol{\alpha}}\right\|}\right\| & \leq 2\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2}\right\|\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2}\right\| \delta \\
& =2 \sqrt{\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{-1}\right\|\left\|\boldsymbol{\Omega}_{\mathbf{r}}\right\| \delta}
\end{aligned}
$$

Then
$$
\begin{aligned}
\frac{\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathbf{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathbf{r}}\right)} & =1-\frac{1}{2}\left\|\frac{\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \boldsymbol{\alpha}}{\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \boldsymbol{\alpha}\right\|}-\frac{\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \hat{\boldsymbol{\alpha}}}{\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \hat{\boldsymbol{\alpha}}\right\|}\right\|^{2} \\
& \geq 1-2\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{-1}\right\|\left\|\boldsymbol{\Omega}_{\mathbf{r}}\right\| \delta^{2}
\end{aligned}
$$

Theorem 10.3(Misspecification of Risk): If there is $\kappa>0$ such that
$$
\begin{equation*}
\left\|\boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2} \hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2}-\kappa \mathbf{I}_{n}\right\| \leq \delta \tag{10.29}
\end{equation*}
$$

Then
$$
\begin{equation*}
\frac{\operatorname{SR}\left(\hat{\boldsymbol{\alpha}}, \hat{\boldsymbol{\Omega}}_{\mathbf{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathbf{r}}\right)} \geq 1-\frac{2 \delta}{\kappa+\delta} \tag{10.30}
\end{equation*}
$$

Proof. Let $\mathbf{H}:=\boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2} \hat{\boldsymbol{\Omega}}_{\mathbf{r}}^{-1} \boldsymbol{\Omega}_{\mathbf{r}}^{1 / 2}$ and let $\hat{\boldsymbol{\alpha}}:=\boldsymbol{\Omega}_{\mathbf{r}}^{-1 / 2} \boldsymbol{\alpha}$. Using this notation, the SRE Equation (10.24) and condition (10.29) are
$$
\begin{aligned}
& \frac{\operatorname{SR}\left(\boldsymbol{\alpha}, \hat{\boldsymbol{\Omega}}_{\mathbf{r}}\right)}{\operatorname{SR}\left(\boldsymbol{\alpha}, \boldsymbol{\Omega}_{\mathbf{r}}\right)}=\frac{\hat{\boldsymbol{\alpha}}^{\top} \mathbf{H} \hat{\boldsymbol{\alpha}}}{\|\hat{\boldsymbol{\alpha}}\|^{2}} \sqrt{\frac{\|\hat{\boldsymbol{\alpha}}\|^{2}}{\hat{\boldsymbol{\alpha}}^{\top} \mathbf{H}^{2} \hat{\boldsymbol{\alpha}}}} \\
& \left\|\mathbf{H}-\kappa \mathbf{I}_{n}\right\| \leq \delta
\end{aligned}
$$

Let $\lambda_{1} \geq \lambda_{2} \geq \ldots \lambda_{n}$ eigenvalues of $\mathbf{H}$. The condition $\left\|\mathbf{H}-\kappa \mathbf{I}_{n}\right\| \leq \delta$ is equivalent to $\left|\lambda_{i}-\kappa\right| \leq \delta$ for all $i=1, \ldots, n$.
$$
\begin{gathered}
\frac{\hat{\boldsymbol{\alpha}}^{\top} \mathbf{H} \hat{\boldsymbol{\alpha}}}{\|\hat{\boldsymbol{\alpha}}\|^{2}} \geq \lambda_{n} \geq \kappa-\delta \\
\frac{\hat{\boldsymbol{\alpha}}^{\top} \mathbf{H}^{2} \hat{\boldsymbol{\alpha}}}{\|\hat{\boldsymbol{\alpha}}\|^{2}} \leq \lambda_{1}^{2} \leq(\kappa+\delta)^{2} \\
\Rightarrow \frac{\hat{\boldsymbol{\alpha}}^{\top} \mathbf{H} \hat{\boldsymbol{\alpha}}}{\|\hat{\boldsymbol{\alpha}}\|^{2}} \sqrt{\frac{\|\hat{\boldsymbol{\alpha}}\|^{2}}{\hat{\boldsymbol{\alpha}}^{\top} \mathbf{H}^{2} \hat{\boldsymbol{\alpha}}}} \geq \frac{\kappa-\delta}{\kappa+\delta}=1-\frac{2 \delta}{\kappa+\delta}
\end{gathered}
$$

The population covariance matrix is not known. A one-period proxy for the covariance matrix is $\mathbf{r r}^{\top}$. The next lemma presents a closed-form expression of the left-hand side of Inequality (10.29) when $\boldsymbol{\Omega}_{\mathrm{r}}$ is replaced by this proxy.
