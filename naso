\title{
Notes on Alpha Stream Optimization
}


\begin{abstract}
In these notes we discuss investment allocation to multiple alpha streams traded on the same execution platform, including when trades are crossed internally resulting in turnover reduction. We discuss approaches to alpha weight optimization where one maximizes $\mathrm{P} \& \mathrm{~L}$ subject to bounds on volatility (or Sharpe ratio). The presence of negative alpha weights, which are allowed when alpha streams are traded on the same execution platform, complicates the optimization problem. By using factor model approach to alpha covariance matrix, the original optimization problem can be viewed as a 1-dimensional root searching problem plus an optimization problem that requires a finite number of iterations. We discuss this approach without costs and with linear costs, and also with nonlinear costs in a certain approximation, which makes the allocation problem tractable without forgoing nonlinear portfolio capacity bound effects.
\end{abstract}

\section*{1 Introduction and Summary}

Nowadays, technology allows to combine a large number of hedge fund alpha streams on the same trading platform. ${ }^{3}$ Not only does this yield diversification, but also reduces transaction costs by crossing trades between different alpha streams. ${ }^{4}$ Given a set of alpha streams, one has to decide how to allocate funds into these alphas, i.e., the weights with which to combine them. ${ }^{5}$ This is an old dilemma between greed and prudence - does one maximize the $\mathrm{P} \& \mathrm{~L}$, does one minimize the volatility, does one do something in between, or does one simply split the difference and maximize the Sharpe ratio instead? It all depends on one's risk tolerance. For instance, one could say, I want to maximize my P\&L, but I also want my volatility to be capped, or the Sharpe ratio to be bounded from below, etc.

The purpose of these notes is to discuss aspects of optimizing weights for alpha streams. When we have a large number $N$ of alphas $\alpha_{i}$, this optimization is an $N$-dimensional problem and does not always have a simple solution. One way to tackle it is to try to essentially reduce it to a 1-dimensional problem, by considering simpler problems of maximizing $\mathrm{P} \& \mathrm{~L}$ for fixed volatility or Sharpe ratio, or by maximizing (minimizing) Sharpe ratio (volatility) for fixed P\&L, and then to try to find a desirable configuration using standard search techniques. This works in some cases, but not always. One issue is that, when alpha streams are combined on the same trading platform, some weights can be negative - this is to be contrasted with the case when alpha streams are traded on their individual trading platforms, i.e., a fund of funds type of a case, where the weights are non-negative. The weights being signed quantities complicates things because the weight normalization condition reads
$$
\begin{equation*}
\sum_{i=1}^{N}\left|w_{i}\right|=1 \tag{1}
\end{equation*}
$$

It is the modulus in this condition that is the source of the headache. Furthermore, when trades between different alphas are crossed, the resulting portfolio turnover reduces (compared with the case with no internal crossing) adding further complexity to the problem. In [57] we discussed alpha stream optimization via Sharpe ratio maximization in the presence of linear costs. There, because the Sharpe ratio is invariant ${ }^{6}$ under the rescalings $w_{i} \rightarrow \lambda w_{i}$, the condition (1) does not affect anything, because it is "trivially" satisfied by finding a solution without such a constraint and then simply rescaling all $w_{i}$ so they satisfy (1). In the case where one does not maximize the Sharpe ratio but employs a more complex optimization criterion, scale invariance is lost and (1) causes complications in the minimization of the objective function similar to those discussed in [57], but even trickier.

\footnotetext{
${ }^{3}$ For a partial list of hedge fund literature, see, e.g., [1]-[20] and references therein.
${ }^{4}$ For a recent discussion, see [21].
5 For a partial list of portfolio optimization and related literature, see, e.g., [22]-[56] and references therein.
${ }^{6}$ More precisely this is the case with no costs or linear costs only.
}

One of our main observations is that, if the alpha covariance matrix is of a factor model form, then an optimum can be found via a finite iterative procedure for a practically interesting range of the $\mathrm{P} \& \mathrm{~L}$ and Sharpe ratio/volatility. ${ }^{7}$ In Section 2 we set up our notations. In Section 3 we discuss the case of a diagonal covariance matrix, where the aforesaid modulus issue is absent. We discuss a relaxation algorithm for finding quasi-optimal weights (which are generally expected to be close to the optimal solution when the number of alphas is large) in Subsection 3.1. In Subsection 3.2 we discuss an algorithm for finding the weights when the $\mathrm{P} \& \mathrm{~L}$ is maximized while the Sharpe ratio is fixed. In Subsection 3.3 we discuss a solution minimizing volatility (maximizing the Sharpe ratio) with the P\&L fixed. In Section 4 we discuss the case of a non-diagonal covariance matrix and a trick where one effectively diagonalizes it by utilizing synthetic tradable portfolios. The problem then reduces to an iterative procedure where one needs to solve for the effective investment level. This procedure, however, generally is expected to have convergence issues which are obscured by the diagonalization trick. In Section 5 we therefore discuss how to tackle the problem directly in the original $w_{i}$ basis, without diagonalizing the covariance matrix, and discuss the problem of minimizing the volatility with the $\mathrm{P} \& \mathrm{~L}$ fixed, which is solvable via a finite iterative procedure assuming a multi-factor form for the covariance matrix. More precisely, this is the case for the practically interesting range of the $\mathrm{P} \& \mathrm{~L}$ above its value corresponding to the maximum of the Sharpe ratio. We then generalize this approach to include linear costs in Section 6 and also nonlinear costs (impact) in Section 7. In the latter case we employ the approximation discussed in [57]. Section 8 concludes the paper with some observations and comments.

\footnotetext{
${ }^{7}$ More precisely, this is the case with no costs or linear costs, and also in the presence of nonlinear costs in a certain approximation.
}


\section*{2 Definitions}

We have $N$ alphas $\alpha_{i}, i=1, \ldots, N$. Each alpha is actually a time series $\alpha_{i}\left(t_{s}\right)$, $s=0,1, \ldots, M$, where $t_{0}$ is the most recent time. Below $\alpha_{i}$ refers to $\alpha_{i}\left(t_{0}\right)$.

Let $C_{i j}$ be the covariance matrix of the $N$ time series $\alpha_{i}\left(t_{s}\right)$. Let $\Psi_{i j}$ be the corresponding correlation matrix, i.e.,
$$
\begin{equation*}
C_{i j}=\sigma_{i} \sigma_{j} \Psi_{i j} \tag{2}
\end{equation*}
$$
where $\Psi_{i i}=1$.
Alphas $\alpha_{i}$ are combined with weights $w_{i}$ such that
$$
\begin{equation*}
\sum_{i=1}^{N}\left|w_{i}\right|=1 \tag{3}
\end{equation*}
$$

Here the modulus accounts for the fact that, when alphas are combined on the same trading platform, some weights can be negative if the covariance matrix $C_{i j}$ is not diagonal, even if all alphas are positive.

To begin with, we will ignore trading costs. Portfolio P\&L, volatility and Sharpe ratio are given by
$$
\begin{align*}
P & =I \sum_{i=1}^{N} \alpha_{i} w_{i}  \tag{4}\\
R & =I \sqrt{\sum_{i, j=1}^{N} C_{i j} w_{i} w_{j}}  \tag{5}\\
S & =\frac{P}{R} \tag{6}
\end{align*}
$$
where $I$ is the investment level. Our goal is to find the set of $w_{i}$ for which ${ }^{8}$
$$
\begin{align*}
& P \rightarrow \max  \tag{7}\\
& S \geq S_{\min } \tag{8}
\end{align*}
$$
for a given Sharpe ratio lower bound $S_{\min }$.
In practice, we can approach this problem in the following ways. First, we can start with the maximal possible P\&L - which means that all weights, other than the weight corresponding to the largest alpha, are zero - and find a relaxation by gradually reducing the $\mathrm{P} \& \mathrm{~L}$ until (8) is satisfied. Second, we can solve a simplified problem $P \rightarrow \max$ for a fixed value of $S=S_{*}$, and then use a standard searching algorithm based on a discrete set of values of $S_{*}$ within the desired precision. Third, we can solve another simplified problem $S \rightarrow$ max for a fixed value of $P$, and then use a standard searching algorithm based on a discrete set of values of $P$ within the desired precision. I.e., the basic idea is to reduce the large $N$-dimensional problem to a 1-dimensional searching algorithm. In some cases this approach does work.

\footnotetext{
${ }^{8}$ In practice, one may have to restate this criterion - see Section 8.
}

\section*{3 Diagonal Case}

When $C_{i j}$ is not diagonal, some weights can be negative even if all alphas are positive. The modulus in (3) complicates things. However, if $C_{i j}$ is diagonal, $C_{i j}=\sigma_{i}^{2} \delta_{i j}$, then, assuming all $\alpha_{i} \geq 0$ (which we can do without loss of generality), all $w_{i} \geq 0$ as well. ${ }^{9}$ Our optimization problem simplifies as follows. Let
$$
\begin{align*}
& \widehat{\alpha}_{i} \equiv \nu_{i} \alpha_{i}  \tag{9}\\
& \widehat{w}_{i} \equiv \sigma_{i} w_{i}  \tag{10}\\
& \nu_{i} \equiv 1 / \sigma_{i} \tag{11}
\end{align*}
$$

\footnotetext{
${ }^{9}$ This is because a configuration with a negative $w_{\ell}$ has the same volatility as and a lower P\&L than the configuration with the sign of $w_{\ell}$ flipped.
}

Then we have
$$
\begin{align*}
& P=I \sum_{i=1}^{N} \widehat{\alpha}_{i} \widehat{w}_{i}  \tag{12}\\
& R=I \sqrt{\sum_{i=1}^{N} \widehat{w}_{i}^{2}} \tag{13}
\end{align*}
$$
and the optimization problem now is (7) and (8) subject to
$$
\begin{align*}
& \sum_{i=1}^{N} \nu_{i} \widehat{w}_{i}=1  \tag{14}\\
& \widehat{w}_{i} \geq 0 \tag{15}
\end{align*}
$$
with all $\widehat{\alpha}_{i} \geq 0$. Below we discuss a simple relaxation algorithm for maximizing P\&L for $S=S_{*}$.

\subsection*{3.1 Quasi-Optimal Weights}

We can obtain a quasi-optimal solution as follows. Recall that all $\widehat{\alpha}_{i}$ are nonnegative. First, let us label alphas such that $\alpha_{1}=\max \left(\alpha_{i}, i=1, \ldots, N\right)$. It is clear that $P$ is maximized when all $\widehat{w}_{i}$ vanish except for $\widehat{w}_{1}$. If for such $\widehat{w}_{i}$ the condition $S \geq S_{*}$ is satisfied, then this is the optimal solution. However, if it is not satisfied, then we need to sacrifice $\mathrm{P} \& \mathrm{~L} P$ in order to increase the Sharpe ratio $S$ by allowing $\widehat{w}_{2}, \widehat{w}_{3}$, etc., to be non-zero until (8) is satisfied, where $\widehat{\alpha}_{i}$ are sorted as follows. ${ }^{10}$

\subsubsection*{3.1.1 Sorting Alphas}

For each subset
$$
\begin{array}{ll}
\widehat{w}_{i}>0, & i=1, \ldots, K \\
\widehat{w}_{i}=0, & i=K+1, \ldots, N \tag{17}
\end{array}
$$
the Sharpe ratio is given by (recall that $\widehat{\alpha}_{i} \geq 0$ )
$$
\begin{equation*}
S(K)=\frac{\sum_{i=1}^{K} \widehat{\alpha}_{i} \widehat{w}_{i}}{\sqrt{\sum_{i=1}^{K} \widehat{w}_{i}^{2}}} \tag{18}
\end{equation*}
$$

We want to find $\widehat{w}_{i}, i=1, \ldots, K$ that maximize $S(K)$ subject to (14):
$$
\begin{equation*}
\sum_{i=1}^{K} \nu_{i} \widehat{w}_{i}=1 \tag{19}
\end{equation*}
$$

\footnotetext{
${ }^{10}$ This sorting is a relaxation algorithm: we start with the maximal $\mathrm{P} \& \mathrm{~L}$ by allocating all investment into $\alpha_{1}$ and at each successive step add one more alpha such that $\mathrm{P} \& \mathrm{~L}$ is maximized when the weights are allocated to maximize the Sharpe ratio, until we reach the bound $S_{*}$.
}

Let us introduce a Lagrange multiplier $\mu$ :
$$
\begin{equation*}
\widetilde{S}(K)=S(K)+\mu\left(\sum_{i=1}^{K} \nu_{i} \widehat{w}_{i}-1\right) \tag{20}
\end{equation*}
$$

Then the solution for $\widehat{w}_{i}$ that maximizes $S(K)$ subject to (19) is given by
$$
\begin{align*}
\frac{\partial \widetilde{S}(K)}{\partial \widehat{w}_{i}} & =0  \tag{21}\\
\frac{\partial \widetilde{S}(K)}{\partial \mu} & =0 \tag{22}
\end{align*}
$$

The $\mu$ equation gives (19). The $\widehat{w}_{i}$ equations give
$$
\begin{align*}
& \widehat{w}_{i}=\gamma \widehat{\alpha}_{i}+\beta \nu_{i}, \quad i=1, \ldots, K  \tag{23}\\
& \gamma=\frac{\sum_{i=1}^{K} \widehat{w}_{i}^{2}}{\sum_{i=1}^{K} \widehat{\alpha}_{i} \widehat{w}_{i}}  \tag{24}\\
& \beta=\mu \gamma\left(\sum_{i=1}^{K} \widehat{w}_{i}^{2}\right)^{\frac{1}{2}} \tag{25}
\end{align*}
$$

Plugging (23) into (24), we have two solutions, $\beta=-\gamma \sum_{i=1}^{K} \alpha_{i} \nu_{i} / \sum_{i=1}^{K} \nu_{i}^{2}$, and $\beta=0$. However, the former would imply $\sum_{i=1}^{K} \nu_{i} \widehat{w}_{i}=0$, so we have the following unique solution with $\beta=0$ and $\mu=0$ :
$$
\begin{align*}
& \widehat{w}_{i}=\gamma \widehat{\alpha}_{i}  \tag{26}\\
& \gamma=\frac{1}{\sum_{i=1}^{K} \nu_{i} \widehat{\alpha}_{i}} \tag{27}
\end{align*}
$$
where $\gamma$ is fixed using (19).
The corresponding P\&L in Eq. (12) is given by
$$
\begin{equation*}
\frac{P(K)}{I}=\frac{\sum_{i=1}^{K} \widehat{\alpha}_{i}^{2}}{\sum_{i=1}^{K} \nu_{i} \widehat{\alpha}_{i}}=\frac{\sum_{i=1}^{K} \nu_{i}^{2} \alpha_{i}^{2}}{\sum_{i=1}^{K} \nu_{i}^{2} \alpha_{i}} \tag{28}
\end{equation*}
$$
where we have used (9). In the remainder of this sub-subsection it will be more convenient to work with the original $\alpha_{i}$ as opposed to $\widehat{\alpha}_{i}$.

Let us sort $\alpha_{i}$ such that $P(K)$ is maximized for each $K$. I.e., for $K=1$ we have $\alpha_{1}$ such that $P(1)$ is maximized (which implies $\alpha_{1}=\max \left(\alpha_{i}, i=1 \ldots, N\right)$ ), for $K=2$ we have $\alpha_{1}$ and $\alpha_{2}$, where $\alpha_{1}$ is fixed at $K=1$ as above, and $\alpha_{2}$ is such that $P(2)$ is maximized, etc. With this sorting, $P(K)$ is a monotonically decreasing function of $K$. To see this, let $\alpha_{i}, i=1, \ldots, K+2$ be sorted as above (i.e., such
that at each $K$ the $\mathrm{P} \& \mathrm{~L} P(K)$ is maximized), and let
$$
\begin{align*}
a & \equiv \sum_{i=1}^{K} \nu_{i}^{2} \alpha_{i}  \tag{29}\\
b & \equiv \sum_{i=1}^{K} \nu_{i}^{2} \alpha_{i}^{2}  \tag{30}\\
x & \equiv \alpha_{K+1}  \tag{31}\\
y & \equiv \alpha_{K+2}  \tag{32}\\
u & \equiv \nu_{K+1}^{2}  \tag{33}\\
v & \equiv \nu_{K+2}^{2} \tag{34}
\end{align*}
$$

Without loss of generality, we will assume that all $\alpha_{i}$ are distinct, and all $\nu_{i}$ are distinct, $i=1, \ldots, K+2$. As above, let: $P(K)$ correspond to $K$ alphas $\alpha_{i}, i=$ $1, \ldots, K ; P(K+1)$ correspond to $K+1$ alphas $\alpha_{i}, i=1, \ldots, K+1$; and $P(K+2)$ correspond to $K+2$ alphas $\alpha_{i}, i=1, \ldots, K+2$. Also, let $P^{\prime}(K+1)$ correspond to $K+1$ alphas $\alpha_{i}^{\prime}, i=1, \ldots, K+1$, where $\alpha_{i}^{\prime}=\alpha_{i}$ for $i=1, \ldots, K$, and $\alpha_{K+1}^{\prime}=\alpha_{K+2}$. By definition, we have
$$
\begin{equation*}
P(K+1)>P^{\prime}(K+1) \tag{35}
\end{equation*}
$$

This implies that
$$
\begin{equation*}
a u x^{2}+v y\left(b+u x^{2}\right)>b u x+v y^{2}(a+u x) \tag{36}
\end{equation*}
$$

Now assume that $P(K+2)>P(K+1)$, which would imply
$$
\begin{equation*}
y>\frac{b+u x^{2}}{a+u x} \tag{37}
\end{equation*}
$$

Together with (36) we would then have
$$
\begin{equation*}
x>\frac{b}{a} \tag{38}
\end{equation*}
$$
and
$$
\begin{equation*}
P(K+1)-P(K)=\frac{b+u x^{2}}{a+u x}-\frac{b}{a}=\frac{u x(a x-b)}{a(a+u x)}>0 \tag{39}
\end{equation*}
$$
i.e., $P(K)<P(K+1)<P(K+2)$, and $P(K)$ must monotonically increase with $K$. However, this is not possible as $P(2)<P(1)$ :
$$
\begin{equation*}
P(2)-P(1)=\nu_{2}^{2} \alpha_{2} \frac{\alpha_{2}-\alpha_{1}}{\nu_{1}^{2} \alpha_{1}+\nu_{2}^{2} \alpha_{2}}<0 \tag{40}
\end{equation*}
$$
as $\alpha_{1}=\max \left(\alpha_{i}, i=1 \ldots, N\right)$. This implies that for no $K$ can $P(K+2)>P(K+1)$, and $P(K)$ monotonically decreases with $K$.

\subsubsection*{3.1.2 Computing Weights}

With the aforementioned ordering of $\widehat{\alpha}_{i}$, for each subset
$$
\begin{array}{ll}
\widehat{w}_{i}>0, & i=1, \ldots, K \\
\widehat{w}_{i}=0, & i=K+1, \ldots, N \tag{42}
\end{array}
$$
the Sharpe ratio is maximized when (see above)
$$
\begin{equation*}
\widehat{w}_{i}=\gamma \widehat{\alpha}_{i}, \quad i=1, \ldots, K \tag{43}
\end{equation*}
$$
where $\gamma>0$ is a constant. The corresponding Sharpe ratio is given by
$$
\begin{equation*}
S(K)=\sqrt{\sum_{i=1}^{K} \widehat{\alpha}_{i}^{2}} \tag{44}
\end{equation*}
$$

The corresponding P\&L in Eq. (12) is given by
$$
\begin{equation*}
\frac{P(K)}{I}=\frac{\sum_{i=1}^{K} \widehat{\alpha}_{i}^{2}}{\sum_{i=1}^{K} \nu_{i} \widehat{\alpha}_{i}} \tag{45}
\end{equation*}
$$

Here, as above, we sort $\widehat{\alpha}_{i}$ such that $P(K)$ is maximized for each $K$. I.e., for $K=1$ we have $\widehat{\alpha}_{1}$ such that $P(1)$ is maximized, for $K=2$ we have $\widehat{\alpha}_{1}$ and $\widehat{\alpha}_{2}$, where $\widehat{\alpha}_{1}$ is fixed at $K=1$ as above, and $\widehat{\alpha}_{2}$ is such that $P(2)$ is maximized, etc. As we showed above, with this sorting, $P(K)$ is a monotonically decreasing function of $K$.

Let $K_{*}$ be such that
$$
\begin{align*}
& S\left(K_{*}-1\right)<S_{*}  \tag{46}\\
& S\left(K_{*}\right) \geq S_{*} \tag{47}
\end{align*}
$$

Then a quasi-optimal solution (see below), for which we have $S=S_{*}$, is given by
$$
\begin{align*}
& \widehat{w}_{i}=\gamma \widehat{\alpha}_{i}, \quad i=1, \ldots, K_{*}-1  \tag{48}\\
& \widehat{w}_{K_{*}}=\gamma \eta \widehat{\alpha}_{K_{*}}  \tag{49}\\
& \widehat{w}_{i}=0, \quad i=K_{*}+1, \ldots, N \tag{50}
\end{align*}
$$
where $\gamma$ will be fixed via (14), and $0<\eta \leq 1$ is fixed by the requirement that for these weights $S=S_{*}$ :
$$
\begin{equation*}
\frac{\sum_{i=1}^{K_{*}-1} \widehat{\alpha}_{i}^{2}+\eta \widehat{\alpha}_{K_{*}}^{2}}{\sqrt{\sum_{i=1}^{K_{*}-1} \widehat{\alpha}_{i}^{2}+\eta^{2} \widehat{\alpha}_{K_{*}}^{2}}}=S_{*} \tag{51}
\end{equation*}
$$
which gives ${ }^{11}$
$$
\begin{equation*}
\eta=\frac{\widetilde{S}_{1}^{2}-\widetilde{S}_{1} \widetilde{S}_{*} \sqrt{\widetilde{S}_{2}^{2}-\widetilde{S}_{*}^{2}}}{\widetilde{S}_{*}^{2}-1} \tag{52}
\end{equation*}
$$

\footnotetext{
${ }^{11}$ Eq. (51) has two roots, and the correct root is fixed by the requirement that $0<\eta \leq 1$.
}
where
$$
\begin{align*}
& \widetilde{S}_{1} \equiv S\left(K_{*}-1\right) / \widehat{\alpha}_{K_{*}}  \tag{53}\\
& \widetilde{S}_{2} \equiv S\left(K_{*}\right) / \widehat{\alpha}_{K_{*}}  \tag{54}\\
& \widetilde{S}_{*} \equiv S_{*} / \widehat{\alpha}_{K_{*}}  \tag{55}\\
& S_{2}^{2}=S_{1}^{2}+1 \tag{56}
\end{align*}
$$

Note that $\eta=1$ if $S_{*}=S\left(K_{*}\right)$.
The reason why the above solution is not necessarily optimal is that $P(K)$ depends on the ordering of $\widehat{\alpha}_{i}$ - we order $\widehat{\alpha}_{i}$ such that at each step $K \rightarrow K+1$ the $\mathrm{P} \& \mathrm{~L} P(K+1)$ is maximized, but this does not guarantee that there is no other ordering for which the same Sharpe ratio $S_{*}$ (or higher) cannot be achieved for a higher $\mathrm{P} \& \mathrm{~L}$, because the $\mathrm{P} \& \mathrm{~L}$ can be path dependent. For large $N$ this path dependence is expected to be suppressed. ${ }^{12}$ In the next two subsections we discuss two ways of constructing the optimal solution.

\footnotetext{
${ }^{12}$ More precisely, this is expected to be the case for generic alpha configurations.
}

\subsection*{3.2 Optimal Weights}

In this subsection we discuss the problem of maximizing $\mathrm{P} \& \mathrm{~L}$ with the Sharpe ratio fixed: $S=S_{*}$. We have
$$
\begin{equation*}
S=\frac{\sum_{i=1}^{N} \widehat{\alpha}_{i} \widehat{w}_{i}}{\sqrt{\sum_{i=1}^{N} \widehat{w}_{i}^{2}}} \tag{57}
\end{equation*}
$$

The condition $S=S_{*}$ can be written as
$$
\begin{equation*}
\widehat{w}^{T} \Theta \widehat{w}=0 \tag{58}
\end{equation*}
$$
where
$$
\begin{equation*}
\Theta_{i j} \equiv \widehat{\alpha}_{i} \widehat{\alpha}_{j}-S_{*}^{2} \delta_{i j} \tag{59}
\end{equation*}
$$

The matrix $\Theta_{i j}$ has the following eigenvalue structure:
$$
\begin{align*}
& \Theta \phi=\theta_{*} \phi  \tag{60}\\
& \Theta \chi^{(A)}=\theta^{\prime} \chi^{(A)}, \quad A=1, \ldots, N-1 \tag{61}
\end{align*}
$$
where the eigenvectors $\phi$ and $\chi^{(A)}$ and the eigenvalues $\theta_{*}$ and $\theta^{\prime}$ are given by
$$
\begin{align*}
& \phi_{i}=\frac{\widehat{\alpha}_{i}}{a}  \tag{62}\\
& \sum_{i=1}^{N} \chi_{i}^{(A)} \phi_{i}=0  \tag{63}\\
& \theta_{*}=a^{2}-S_{*}^{2}  \tag{64}\\
& \theta^{\prime}=-S_{*}^{2} \tag{65}
\end{align*}
$$

and ${ }^{13}$
$$
\begin{equation*}
a \equiv \sqrt{\sum_{i=1}^{N} \widehat{\alpha}_{i}^{2}} \tag{66}
\end{equation*}
$$

\footnotetext{
${ }^{13}$ Note that $S_{\max }=a$, and $\widehat{w}_{i}=\widehat{\alpha}_{i} / \sum_{j=1}^{N} \nu_{j} \widehat{\alpha}_{j}$ for $S=S_{\max }$. Below we assume $S_{*}<S_{\max }$.
}

The eigenvectors $\chi^{(A)}$ are orthogonal to the eigenvector $\phi$. In fact, let us take them to be orthonormal:
$$
\begin{equation*}
\sum_{i=1}^{N} \chi_{i}^{(A)} \chi_{i}^{(B)}=\delta_{A B} \tag{67}
\end{equation*}
$$
where $A, B=1, \ldots, N-1$. Note that $\phi$ has norm 1 as defined above.
Note that the $N$ eigenvectors $\phi$ and $\chi^{(A)}$ form a complete linearly independent set of $N$-vectors. Therefore, the optimal solution $\widehat{w}_{i}$ can be written as
$$
\begin{equation*}
\widehat{w}_{i}=\gamma\left(\phi_{i}+\sum_{A=1}^{N-1} \beta_{A} \chi_{i}^{(A)}\right) \tag{68}
\end{equation*}
$$
where $\gamma$ and $\beta_{A}, A=1, \ldots, N-1$ are $N$ unknown coefficients we must determine. The P\&L (12), the Sharpe ratio condition (58) and the weight normalization condition (14) now read:
$$
\begin{align*}
& \frac{P}{I}=a \gamma  \tag{69}\\
& \sum_{A=1}^{N-1} \beta_{A}^{2}=r^{2}  \tag{70}\\
& \gamma\left(\widetilde{\phi}+\sum_{A=1}^{N-1} \beta_{A} \widetilde{\chi}_{A}\right)=1  \tag{71}\\
& \phi_{i}+\sum_{A=1}^{N-1} \beta_{A} \chi_{i}^{(A)} \geq 0, \quad i=1, \ldots, N \tag{72}
\end{align*}
$$
where the last condition follows from the requirement that for the optimal solution all $\widehat{w}_{i} \geq 0$ due to the fact that all $\widehat{\alpha}_{i} \geq 0$, and
$$
\begin{align*}
& r^{2} \equiv-\frac{\theta_{*}}{\theta^{\prime}}=\frac{a^{2}}{S_{*}^{2}}-1  \tag{73}\\
& \widetilde{\phi} \equiv \sum_{i=1}^{N} \nu_{i} \phi_{i}  \tag{74}\\
& \widetilde{\chi}_{A} \equiv \sum_{i=1}^{N} \nu_{i} \chi_{i}^{(A)} \tag{75}
\end{align*}
$$

So, our optimization problem is now reduced to maximizing $\gamma$ subject to (70), (71) and (72). I.e., our optimization problem now reads:
$$
\begin{align*}
& Y \equiv \sum_{A=1}^{N-1} \beta_{A} \widetilde{\chi}_{A} \rightarrow \min  \tag{76}\\
& \sum_{A=1}^{N-1} \beta_{A}^{2}=r^{2}  \tag{77}\\
& \phi_{i}+\sum_{A=1}^{N-1} \beta_{A} \chi_{i}^{(A)} \geq 0, \quad i=1, \ldots, N \tag{78}
\end{align*}
$$

This optimization problem can be solved as follows.
Note that $\beta_{A}$ live on an $(N-2)$-sphere of radius $r$, so the sum in (76) is bounded both from below and above. Also, note that without loss of generality we can always assume that $\tilde{\chi}_{A}$ has the following canonical form:
$$
\begin{align*}
& \widetilde{\chi}_{1} \equiv \kappa>0  \tag{79}\\
& \widetilde{\chi}_{A}=0, \quad A=2, \ldots, N-1 \tag{80}
\end{align*}
$$

We can always rotate $\chi_{i}^{(A)}$ and $\beta_{A}$ into the above canonical form using an $S O(N-1)$ rotation (under which $Y$ is invariant):
$$
\begin{align*}
& \chi_{i}^{(A)} \rightarrow \sum_{B=1}^{N-1} U_{A B} \chi_{i}^{(B)}, \quad A=1, \ldots, N-1  \tag{81}\\
& \widetilde{\chi}_{A} \rightarrow \sum_{B=1}^{N-1} U_{A B} \widetilde{\chi}_{B}, \quad A=1, \ldots, N-1  \tag{82}\\
& \beta_{A} \rightarrow \sum_{B=1}^{N-1} U_{A B} \beta_{B}, \quad A=1, \ldots, N-1  \tag{83}\\
& \sum_{C=1}^{N-1} U_{A C} U_{B C}=\delta_{A B}, \quad A, B=1, \ldots, N-1 \tag{84}
\end{align*}
$$
and the sign of $\widetilde{\chi}_{1}$ can always be set by appropriately flipping the signs of the eigenvectors $\chi_{i}^{(A)}$, if need be.

In the above basis we have
$$
\begin{equation*}
Y=\kappa \beta_{1} \tag{85}
\end{equation*}
$$

Its maximum occurs at $\beta_{1}=r$ (the "North Pole" on the ( $N-2$ )-sphere) and its minimum occurs at $\beta_{1}=-r$ (the "South Pole" on the ( $N-2$ )-sphere). If $\beta_{1}=-r$ satisfies the constraints (72), then this corresponds to the optimal solution. However, the constraints (72) may not be satisfied. From the quasi-optimal solution of Subsection 3.1 we know that a solution with $\widehat{w}_{i} \geq 0$ and the Sharpe ratio equal
$S_{*}$ exists, i.e., there exist values of $\beta_{A}$ on the $(N-2)$-sphere (70) such that (72) are satisfied. However, this might not be the optimal solution. The optimal solution therefore lies along a path with decreasing $\beta_{1}$ connecting the point on the $(N-2)$ sphere corresponding to the quasi-optimal solution and the South Pole. (Note that all paths on an $(N-2)$-sphere are topologically equivalent.) Therefore, we need to identify this point corresponding to the optimal solution. One way of approaching this problem is via reducing the number of $\beta_{A}$ to be determined by utilizing the residual $S O(N-2)$ rotational symmetry.

If for the optimal solution $-r<\beta_{1}<r$, then at least one $\beta_{A}, A=2, \ldots, N-1$ must be non-zero. Without loss of generality we can always assume that $\beta_{A}$ have the following canonical form:
$$
\begin{equation*}
\beta_{A}=0, \quad A=3, \ldots, N-1 \tag{86}
\end{equation*}
$$

We can always rotate $\chi_{i}^{(A)}$ and $\beta_{A}, A=2, \ldots, N-1$ into the above canonical form ${ }^{14}$ using an $S O(N-2)$ rotation (under which $\tilde{\chi}_{A}=0, A=2, \ldots, N-1$ are invariant):
$$
\begin{align*}
& \chi_{i}^{(A)} \rightarrow \sum_{B=2}^{N-1} U_{A B}^{\prime} \chi_{i}^{(B)}, \quad A=2, \ldots, N-1  \tag{87}\\
& \beta_{A} \rightarrow \sum_{B=2}^{N-1} U_{A B}^{\prime} \beta_{B}, \quad A=2, \ldots, N-1  \tag{88}\\
& \sum_{C=2}^{N-1} U_{A C}^{\prime} U_{B C}^{\prime}=\delta_{A B}, \quad A, B=2, \ldots, N-1 \tag{89}
\end{align*}
$$

So we have:
$$
\begin{align*}
& \phi_{i}+\beta_{1} \chi_{i}^{(1)}+\beta_{2} \chi_{i}^{(2)} \geq 0, \quad i=1, \ldots, N  \tag{90}\\
& \beta_{1}^{2}+\beta_{2}^{2}=r^{2} \tag{91}
\end{align*}
$$

Also, since $\phi_{i}$ and $\chi_{i}^{(A)}, A=1, \ldots, N-1$ form a complete orthonormal set of $N$-vectors, there exist coefficients $c$ and $d_{A}, A=1, \ldots, N-1$ such that
$$
\begin{equation*}
c \phi_{i}+\sum_{A=1} d_{A} \chi_{i}^{(A)}=\nu_{i}, \quad i=1, \ldots, N \tag{92}
\end{equation*}
$$

14 Note, however, that while we are free to choose any basis for $\chi_{i}^{(A)}$, assuming the above canonical form implies that $\chi_{i}^{(2)}$ is now unknown and must be determined rather than chosen. I.e., instead of choosing $\chi_{i}^{(A)}$ and trying to determine $\beta_{A}$, we restrict $\beta_{A}$ to the above canonical form at the expense of having to determine $\chi_{i}^{(2)}$.
which implies that
$$
\begin{align*}
& c=\widetilde{\phi}  \tag{93}\\
& d_{1}=\kappa  \tag{94}\\
& d_{A}=0, \quad A=2, \ldots, N-1  \tag{95}\\
& \chi_{i}^{(1)}=\frac{1}{\kappa}\left(\nu_{i}-\widetilde{\phi} \phi_{i}\right)  \tag{96}\\
& \kappa^{2}=\widetilde{\nu}^{2}-\widetilde{\phi}^{2} \tag{97}
\end{align*}
$$
where
$$
\begin{equation*}
\widetilde{\nu}^{2} \equiv \sum_{i=1}^{N} \nu_{i}^{2} \tag{98}
\end{equation*}
$$

We have the following constraints:
$$
\begin{equation*}
\chi_{i}^{(2)} \geq-\frac{1}{\kappa \sqrt{r^{2}-\beta_{1}^{2}}}\left(\beta_{1} \nu_{i}+\left[\kappa-\beta_{1} \widetilde{\phi}\right] \phi_{i}\right) \tag{99}
\end{equation*}
$$
where without loss of generality we assume that $\beta_{2}>0$. (We discuss the $\beta_{2}<0$ case below.)

There are only four a priori conditions (which are the $\widetilde{\chi}_{2}=0$ condition plus the relevant orthonormality conditions) that the constraints (99) must be compatible with:
$$
\begin{align*}
& \sum_{i=1}^{N} \nu_{i} \chi_{i}^{(2)}=0  \tag{100}\\
& \sum_{i=1}^{N} \phi_{i} \chi_{i}^{(2)}=0  \tag{101}\\
& \sum_{i=1}^{N} \chi_{i}^{(1)} \chi_{i}^{(2)}=0  \tag{102}\\
& \sum_{i=1}^{N}\left[\chi_{i}^{(2)}\right]^{2}=1 \tag{103}
\end{align*}
$$

Due to (96), (102) follows from (100) and (101). Also, (101) is automatically compatible with (99). A nontrivial condition follows from (100) and (99) via multiplying both sides of (99) by $\nu_{i}$ and summing over $i=1, \ldots, N$ :
$$
\begin{equation*}
\widetilde{\nu}^{2} \beta_{1}+\widetilde{\phi}\left[\kappa-\beta_{1} \widetilde{\phi}\right] \geq 0 \tag{104}
\end{equation*}
$$
which gives
$$
\begin{equation*}
\beta_{1} \geq \beta_{*} \equiv-\frac{\widetilde{\phi}}{\kappa} \tag{105}
\end{equation*}
$$

Considering that $\beta_{1} \geq-r$, this condition is satisfied if
$$
\begin{equation*}
\widetilde{\phi} \geq \widetilde{\nu} \sqrt{1-\frac{S_{*}^{2}}{a^{2}}} \tag{106}
\end{equation*}
$$

If this condition is not satisfied, then $\beta_{1}>-r$ and the optimal solution satisfying (72) lies away from the South Pole. Note that (106) is a necessary condition to have $\beta_{1}=-r$.

Thus, our optimization problem has been reduced to finding the lowest value of $\beta_{1}$ such that there exits an $N$-vector $\chi^{(2)}$ such that (99), (100), (101) and (103) are satisfied. Assuming $\beta_{1} \geq \beta_{*}$, the constraints (99) can be incompatible with (103), which further constrains $\beta_{1}$. For a given $\beta_{1}$ let $T^{+}$and $T^{-}$be the subsets of the values of the index $i=1, \ldots, N$ such that
$$
\begin{align*}
& \phi_{i}<-\frac{\beta_{1}}{\kappa-\beta_{1} \widetilde{\phi}} \nu_{i}, \quad i \in T^{+}  \tag{107}\\
& \phi_{i} \geq-\frac{\beta_{1}}{\kappa-\beta_{1} \widetilde{\phi}} \nu_{i}, \quad i \in T^{-} \tag{108}
\end{align*}
$$

Then we have $\chi_{i}^{(2)}>0$ for $i \in T^{+}$and (103) may or may not be attainable for such $\beta_{1}$. In the following we will treat $T^{+}$and $T^{-}$as vectors of lengths $N^{+}$and $N^{-}$ $\left(N^{+}+N^{-}=N\right)$, and for $i \in T^{-}$we will use a map $i=T_{a}^{-}$, where $a=1, \ldots, N^{-}$.

We can construct $\chi^{(2)}$ as follows:
$$
\begin{align*}
& \chi_{i}^{(2)}=-\frac{\theta_{i}}{\kappa \sqrt{r^{2}-\beta_{1}^{2}}}\left(\beta_{1} \nu_{i}+\left[\kappa-\beta_{1} \widetilde{\phi}\right] \phi_{i}\right), \quad i \in T^{+}  \tag{109}\\
& \theta_{i} \geq 1, \quad i \in T^{+}  \tag{110}\\
& \sum_{i \in T^{+}}\left[\chi_{i}^{(2)}\right]^{2} \equiv \widetilde{\zeta}  \tag{111}\\
& \sum_{i \in T^{+}} \nu_{i} \chi_{i}^{(2)} \equiv-\widetilde{\chi}  \tag{112}\\
& \sum_{i \in T^{+}} \chi_{i}^{(2)} \phi_{i} \equiv-\widetilde{\xi}  \tag{113}\\
& \chi_{a}^{-} \equiv \chi_{i}^{(2)}, \quad i=T_{a}^{-}, \quad a=1, \ldots, N^{-}  \tag{114}\\
& \varphi_{a} \equiv \phi_{i}, \quad i=T_{a}^{-}, \quad a=1, \ldots, N^{-}  \tag{115}\\
& \omega_{a} \equiv \nu_{i}, \quad i=T_{a}^{-}, \quad a=1, \ldots, N^{-} \tag{116}
\end{align*}
$$

The $N^{-}$-vector $\chi_{a}^{-}$is constrained as follows:
$$
\begin{align*}
& \sum_{a=1}^{N^{-}} \omega_{a} \chi_{a}^{-}=\widetilde{\chi}  \tag{117}\\
& \sum_{a=1}^{N^{-}} \chi_{a}^{-} \varphi_{a}=\widetilde{\xi}  \tag{118}\\
& \sum_{a=1}^{N^{-}}\left[\chi_{a}^{-}\right]^{2}=1-\widetilde{\zeta} \tag{119}
\end{align*}
$$

The vector $\chi_{a}^{-}$can always be decomposed as follows:
$$
\begin{align*}
\chi_{a}^{-} & =c_{-} \varphi_{a}+d_{-} \omega_{a}+\widehat{\chi}_{a}^{-}  \tag{120}\\
c_{-} & \equiv \frac{\widetilde{\lambda} \widetilde{\xi}-\widetilde{\varphi} \widetilde{\chi}}{\widetilde{\sigma} \widetilde{\lambda}-\widetilde{\varphi}^{2}}  \tag{121}\\
d_{-} & \equiv \frac{\widetilde{\sigma} \widetilde{\chi}-\widetilde{\varphi} \widetilde{\xi}}{\widetilde{\sigma} \widetilde{\lambda}-\widetilde{\varphi}^{2}} \tag{122}
\end{align*}
$$
where
$$
\begin{align*}
\widetilde{\sigma} & \equiv \sum_{a=1}^{N^{-}} \varphi_{a}^{2}  \tag{123}\\
\widetilde{\varphi} & \equiv \sum_{a=1}^{N^{-}} \omega_{a} \varphi_{a}  \tag{124}\\
\widetilde{\lambda} & \equiv \sum_{a=1}^{N^{-}} \omega_{a}^{2} \tag{125}
\end{align*}
$$
and the $N^{-}$-vector $\widehat{\chi}_{a}^{-}$is such that
$$
\begin{align*}
& \sum_{a=1}^{N^{-}} \widehat{\chi}_{a}^{-} \omega_{a}=0  \tag{126}\\
& \sum_{a=1}^{N^{-}} \widehat{\chi}_{a}^{-} \varphi_{a}=0 \tag{127}
\end{align*}
$$

With this decomposition, (119) reads
$$
\begin{align*}
& \sum_{a=1}^{N^{-}}\left[\widehat{\chi}_{a}^{-}\right]^{2}=1-\widetilde{\zeta}-\frac{g(\widetilde{\chi}, \widetilde{\xi})}{\widetilde{\sigma} \widetilde{\lambda}-\widetilde{\varphi}^{2}}  \tag{128}\\
& g\left(x_{1}, x_{2}\right) \equiv \widetilde{\sigma} x_{1}^{2}+\widetilde{\lambda} x_{2}^{2}-2 \widetilde{\varphi} x_{1} x_{2} \tag{129}
\end{align*}
$$

Note that
$$
\begin{align*}
& \widetilde{\sigma}=\sum_{i \in T^{-}} \phi_{i}^{2}=\frac{\sum_{i \in T^{-}} \widehat{\alpha}_{i}^{2}}{\sum_{i=1}^{N} \widehat{\alpha}_{i}^{2}} \leq 1  \tag{130}\\
& \frac{\widetilde{\varphi}^{2}}{\widetilde{\sigma}}=\frac{\left(\sum_{i \in T^{-}} \nu_{i} \widehat{\alpha}_{i}\right)^{2}}{\sum_{i \in T^{-}} \widehat{\alpha}_{i}^{2}}<\widetilde{\lambda}=\sum_{i \in T^{-}} \nu_{i}^{2} \tag{131}
\end{align*}
$$
where we assume that $\widehat{\alpha}_{i}, i \in T^{-}$are not all identical, and $\nu_{i}, i \in T^{-}$are not all identical. Further, note that each of $\widetilde{\zeta}, \widetilde{\xi}$ and $\widetilde{\chi}$ is minimized when $\theta_{i} \equiv 1, i \in T^{+}$, while if we fix $\theta_{i}$, then $\widetilde{\zeta}$ increases as $\beta_{1}$ decreases (assuming $\beta_{1}<0$ ). Finally, the eigenvalues of the $2 \times 2$ curvature matrix
$$
\begin{equation*}
\frac{\partial^{2} g\left(x_{1}, x_{2}\right)}{\partial x_{p} \partial x_{q}}, \quad p, q=1,2 \tag{132}
\end{equation*}
$$
are given by
$$
\begin{equation*}
g_{ \pm}=\frac{1}{2}\left(\tilde{\lambda}+\widetilde{\sigma} \pm \sqrt{(\tilde{\lambda}-\widetilde{\sigma})^{2}+4 \widetilde{\varphi}^{2}}\right) \tag{133}
\end{equation*}
$$
and are both positive considering that $\widetilde{\varphi}^{2}<\widetilde{\sigma} \widetilde{\lambda}$. This implies that the r.h.s. of (128) is maximized when $\theta_{i} \equiv 1, i \in T^{+}$. Therefore, the above construction provides $\chi_{i}^{(2)}$ corresponding to the optimal (i.e., minimal) $\beta_{1}$ when $\theta_{i} \equiv 1, i \in T^{+}$and $\widehat{\chi}_{a}^{-} \equiv 0$, $a=1, \ldots, N^{-}$:
$$
\begin{align*}
& \chi_{i}^{(2)}=-\frac{1}{\kappa \sqrt{r^{2}-\beta_{1}^{2}}}\left(\beta_{1} \nu_{i}+\left[\kappa-\beta_{1} \widetilde{\phi}\right] \phi_{i}\right), \quad i \in T^{+}  \tag{134}\\
& \chi_{i}^{(2)}=c_{-} \phi_{i}+d_{-} \nu_{i}, \quad i \in T^{-}  \tag{135}\\
& \widetilde{\zeta}+\frac{g(\widetilde{\chi}, \widetilde{\xi})}{\widetilde{\sigma} \widetilde{\lambda}-\widetilde{\varphi}^{2}}=1 \tag{136}
\end{align*}
$$

The last equation (136) is then used to determine the optimal value of $\beta_{1}$. Practically, one needs to employ an iterative procedure to determine $\beta_{1}$ from (136) because $T^{+}$and $T^{-}$depend on $\beta_{1}$. One way of implementing such an iterative procedure is to use the quasi-optimal solution of the previous subsection. Let $z_{i} \equiv \widehat{w}_{i}$ for that solution. Then the corresponding value of $\beta_{1} \equiv \widehat{\beta}_{1}$ is given by (this follows from (69), (71), (79) and (80))
$$
\begin{equation*}
\widehat{\beta}_{1}=\frac{1-\widetilde{\phi} \sum_{i=1}^{N} z_{i} \phi_{i}}{\kappa \sum_{i=1}^{N} z_{i} \phi_{i}} \tag{137}
\end{equation*}
$$

We can now search for the value of $\beta_{1}$ between $\widehat{\beta}_{1}$ and $\beta_{*}$, e.g., using a standard algorithm such as successively testing midpoints until the l.h.s. of (136) approaches 1 from below with a desired precision.

Above we assume that $\beta_{2}>0$. If we assume that $\beta_{2}<0$, then instead of (99) we have:
$$
\begin{equation*}
\chi_{i}^{(2)} \leq \frac{1}{\kappa \sqrt{r^{2}-\beta_{1}^{2}}}\left(\beta_{1} \nu_{i}+\left[\kappa-\beta_{1} \tilde{\phi}\right] \phi_{i}\right) \tag{138}
\end{equation*}
$$
and the above discussion carries through unchanged except that now $\chi_{i}^{(2)}, i \in T^{+}$ are all negative.

Finally, the weights $\widehat{w}_{i}=0$ for $i \in T^{+}$, while for $i \in T^{-}$they are given by
$$
\begin{equation*}
\widehat{w}_{i}=\frac{\left(1-\frac{\beta_{1}}{\kappa} \widetilde{\phi}+\sqrt{r^{2}-\beta_{1}^{2}} c_{-}\right) \phi_{i}+\left(\frac{\beta_{1}}{\kappa}+\sqrt{r^{2}-\beta_{1}^{2}} d_{-}\right) \nu_{i}}{\widetilde{\phi}+\beta_{1} \kappa} \tag{139}
\end{equation*}
$$

The fact that non-zero $\widehat{w}_{i}$ have a form $\widehat{w}_{i}=e \phi_{i}+f \nu_{i}$ (where $e$ and $f$ are coefficients) is not surprising from symmetry considerations: $\phi_{i}$ and $\nu_{i}$ are the only vectors available as building blocks. However, what is nontrivial is the definition of $T^{+}$and $T^{-}$, i.e., which $\widehat{w}_{i}$ are vanishing.

\subsection*{3.3 Alternative Construction}

We can construct the above optimal solution in a different way. Instead of maximizing $\mathrm{P} \& \mathrm{~L}$ directly, we can i) first minimize the volatility $R$ (i.e., maximize the Sharpe ratio $S$ ) for a fixed value of the $\mathrm{P} \& \mathrm{~L} P$, and ii) then find $P$ such that $S=S_{*}$. I.e., at the first step we solve the following problem:
$$
\begin{align*}
& \frac{P}{I}=\sum_{i=1}^{N} \widehat{\alpha}_{i} \widehat{w}_{i} \equiv \widetilde{P}=\text { fixed }  \tag{140}\\
& \frac{R}{I}=\sqrt{\sum_{i=1}^{N} \widehat{w}_{i}^{2}} \rightarrow \text { min }  \tag{141}\\
& \sum_{i=1}^{N} \nu_{i} \widehat{w}_{i}=1  \tag{142}\\
& \widehat{w}_{i} \geq 0, \quad i=1, \ldots, N \tag{143}
\end{align*}
$$

This problem can be stated as follows:
$$
\begin{align*}
& g(\widehat{w}, \mu, \widetilde{\mu}) \equiv \frac{1}{2} \sum_{i=1}^{N} \widehat{w}_{i}^{2}+\mu\left(\sum_{i=1}^{N} \nu_{i} \widehat{w}_{i}-1\right)+\widetilde{\mu}\left(\sum_{i=1}^{N} \widehat{\alpha}_{i} \widehat{w}_{i}-\widetilde{P}\right)  \tag{144}\\
& g(\widehat{w}, \mu, \widetilde{\mu}) \rightarrow \min  \tag{145}\\
& \widehat{w}_{i} \geq 0, \quad i=1, \ldots, N \tag{146}
\end{align*}
$$
where $\mu$ and $\widetilde{\mu}$ are Lagrange multipliers, i.e., the objective function $g(\widehat{w}, \mu, \widetilde{\mu})$ is minimized w.r.t. $\widehat{w}_{i}, \mu$ and $\widetilde{\mu}$.

The solution is as follows. First, let us sort $\alpha_{i}\left(\right.$ not $\left.\widehat{\alpha}_{i}\right)$ in the decreasing order (recall that $\widehat{\alpha}_{i}=\nu_{i} \alpha_{i}$ ), i.e., $\alpha_{1}=\max \left(\alpha_{i}, i=1, \ldots, N\right)$. Then
$$
\begin{align*}
& \widehat{w}_{i}=\frac{\left(\widetilde{\nu}^{2} \widetilde{P}-a\right) \widehat{\alpha}_{i}-\left(a \widetilde{P}-b^{2}\right) \nu_{i}}{\widetilde{\nu}^{2} b^{2}-a^{2}}, \quad i=1, \ldots, K  \tag{147}\\
& \widehat{w}_{i}=0, \quad i=K+1, \ldots, N  \tag{148}\\
& a \equiv \sum_{i=1}^{K} \nu_{i} \widehat{\alpha}_{i}  \tag{149}\\
& b^{2} \tag{150}
\end{align*}=\sum_{i=1}^{K} \widehat{\alpha}_{i}^{2} \quad 1 .
$$
where the last condition determines $K$, i.e., $K$ is the maximum number of first $K$ alphas $\alpha_{i}$ (sorted in the decreasing order) such that (152), which is equivalent to
$$
\begin{equation*}
\alpha_{i}>\frac{a \widetilde{P}-b^{2}}{\widetilde{\nu}^{2} \widetilde{P}-a}, \quad i=1, \ldots, K \tag{153}
\end{equation*}
$$
is satisfied. Note that $\widetilde{\nu}^{2} b^{2}>a^{2}$ (assuming non-identical $\widehat{\alpha}_{i}$ and non-identical $\nu_{i}$ ). Also, $\widetilde{P} \leq \alpha_{1}$, and we can assume $\widetilde{P}>0$. Finally, note that $\widetilde{P}=b^{2} / a$ corresponds to
$$
\begin{equation*}
S=S_{\max } \equiv \sqrt{\sum_{i=1}^{N} \widehat{\alpha}_{i}^{2}} \tag{154}
\end{equation*}
$$

Indeed, in this case we have $\widehat{w}_{i}=\widehat{\alpha}_{i} / a$ (and all $\widehat{w}_{i}$ are non-vanishing unless some $\widehat{\alpha}_{i}=0$ ). Therefore, we can assume that $\widetilde{P} \geq b^{2} / a$, because, if we consider lower $\widetilde{P}$, we have a solution with higher Sharpe ratio and higher P\&L, so the search can be limited to the values $b^{2} / a<\widetilde{P}<\alpha_{1}$.

Using the above algorithm we can construct $\widehat{w}_{i}$ for any given $\widetilde{P}$. We can then determine the weights corresponding to $S=S_{*}$ using a standard algorithm such as successively testing midpoints between successive values of $\widetilde{P}$ (between $\alpha_{1}$ and $b^{2} / a$ ) until the Sharpe ratio $S$ approaches $S_{*}$ with a desired precision.

\section*{4 Non-Diagonal Case}

When the covariance matrix $C_{i j}$ is non-diagonal, things are more complicated because of the modulus in (3). We can still go into a diagonal basis via the following
trick. Let $V_{i}^{(a)}$ be $N$ right eigenvectors of $C_{i j}$ corresponding to its eigenvalues $\lambda^{(a)}$, $a=1, \ldots, N$ :
$$
\begin{equation*}
C V^{(a)}=\lambda^{(a)} V^{(a)} \tag{155}
\end{equation*}
$$
with no summation over $a$. Since $C$ is symmetric, $V^{(a)}$ can be chosen to be orthonormal:
$$
\begin{equation*}
\sum_{i=1}^{N} V_{i}^{(a)} V_{i}^{(b)}=\delta_{a b} \tag{156}
\end{equation*}
$$
which we assume to be the case. We will also assume that all $\lambda^{(a)}>0$, i.e., $C_{i j}$ is positive-definite. ${ }^{15}$ Furthermore, we will assume that none of the eigenvalues $\lambda^{(a)}$ is "infinitesimally" small compared with others. ${ }^{16}$

Now consider $N$ synthetic portfolios $\Pi^{(a)}, a=1, \ldots, N$, with the weights
$$
\begin{equation*}
w_{i}^{(a)}=\frac{V_{i}^{(a)}}{\sum_{j=1}^{N}\left|V_{j}^{(a)}\right|} \tag{157}
\end{equation*}
$$

Note that
$$
\begin{equation*}
\sum_{i=1}^{N}\left|w_{i}^{(a)}\right|=1 \tag{158}
\end{equation*}
$$

Since we are assuming that all alphas are traded on the same execution platform, the portfolios $\Pi^{(a)}$ are tradable. Furthermore, the covariance matrix for these portfolios is diagonal:
$$
\begin{equation*}
C_{a b} \equiv\left\langle\alpha^{(a)}, \alpha^{(b)}\right\rangle=\frac{\lambda^{(a)}}{\left(\sum_{j=1}^{N}\left|V_{j}^{(a)}\right|\right)^{2}} \delta_{a b} \tag{159}
\end{equation*}
$$

The corresponding alphas are given by
$$
\begin{equation*}
\alpha^{(a)} \equiv \frac{1}{\sum_{j=1}^{N}\left|V_{j}^{(a)}\right|} \sum_{i=1}^{N} V_{i}^{(a)} \alpha_{i} \tag{160}
\end{equation*}
$$
and can be assumed to be non-negative - if any $\alpha^{(a)}$ is negative, we can always make it positive by flipping the signs of the weights in the corresponding synthetic portfolio. Now we could proceed to solve the optimization problem for these synthetic alphas as we did in the previous section. However, the caveat is that if we invest $I$ dollars into a combinations of these synthetic $\alpha^{(a)}$, it does not correspond to investing $I$ dollars into the underlying alphas due to "netting" of alphas ${ }^{17}$ as the

\footnotetext{
${ }^{15}$ A simple method for making a covariance matrix positive-definite was discussed in [58] based on [59].
${ }^{16}$ I.e., none of these eigenvalues are zeros distorted by machine precision, as would be the case if $M<N$ (where $M+1$ is the number of observations in the alpha time series - see Section 2 ).
${ }^{17}$ Not to be confused with the "netting" of underlying tradables.
}
weights $w_{i}^{(a)}$ in various portfolios have opposite signs. So, in the optimization problem, on paper, we need to invest some priori unknown "synthetic" amount $I^{\prime}$ into the synthetic alphas $\alpha^{(a)}$ to have the desired actual investment $I$ in the real alphas $\alpha_{i}$. This amount $I^{\prime}$ would then have to be determined via an iterative procedure. However, for general $C_{i j}$ this iterative procedure can run into stability issues. This is because the optimization now becomes effectively 2 -dimensional. In this regard, it is more streamlined to tackle the problem by dealing with the modulus in (3) directly as opposed to attempting to circumvent it via diagonalization. We discuss this approach in the next section.

\section*{5 Optimal Weights}

Here we will follow the framework of Subsection 3.3 and i) first minimize the volatility $R$ (i.e., maximize the Sharpe ratio $S$ ) for a fixed value of the P\&L $P$, and ii) then find $P$ such that $S=S_{*}$. The second step is straightforward. ${ }^{18}$ At the first step we solve the following problem:
$$
\begin{align*}
\frac{P}{I} & =\sum_{i=1}^{N} \alpha_{i} w_{i} \equiv \widetilde{P}=\text { fixed }  \tag{161}\\
\frac{R}{I} & =\sqrt{\sum_{i, j=1}^{N} C_{i j} w_{i} w_{j}} \equiv \widetilde{R} \rightarrow \min \tag{162}
\end{align*}
$$
subject to
$$
\begin{equation*}
\sum_{i=1}^{N}\left|w_{i}\right|=1 \tag{163}
\end{equation*}
$$
where $C_{i j}$ is arbitrary except that, without loss of generality for our purposes here (see below), we will assume it to be positive-definite. This problem can be stated as follows:
$$
\begin{align*}
& g(w, \mu, \widetilde{\mu}) \equiv \frac{1}{2} \sum_{i, j=1}^{N} C_{i j} w_{i} w_{j}+ \\
& \quad+\mu\left(\sum_{i=1}^{N}\left|w_{i}\right|-1\right)+\widetilde{\mu}\left(\sum_{i=1}^{N} \alpha_{i} w_{i}-\widetilde{P}\right) \rightarrow \min \tag{164}
\end{align*}
$$
where $\mu$ and $\widetilde{\mu}$ are Lagrange multipliers, i.e., the objective function $g(w, \mu, \widetilde{\mu})$ is minimized w.r.t. $w_{i}, \mu$ and $\widetilde{\mu}$. What complicates matters is the modulus of $w_{i}$. The problem can still be solved, albeit it requires a finite iterative procedure, i.e., the solution is exact and is obtained after a finite number of iterations. ${ }^{19}$

\footnotetext{
${ }^{18}$ The second step is a one-dimensional root searching problem.
${ }^{19}$ More precisely, the optimum is unique for $\mu \geq 0$ - see below.
}

Let $J$ and $J^{\prime}$ be the subsets of the index $i=1, \ldots, N$ such that
$$
\begin{array}{ll}
w_{i} \neq 0, & i \in J \\
w_{i}=0, & i \in J^{\prime} \tag{166}
\end{array}
$$

Let
$$
\begin{equation*}
\eta_{i} \equiv \operatorname{sign}\left(w_{i}\right), \quad i \in J \tag{167}
\end{equation*}
$$

Note that, since the modulus has a discontinuous derivative, the minimization equations are not the same as setting first derivatives of $g(w, \mu, \widetilde{\mu})$ to zero. More concretely, first derivatives are well-defined for $i \in J$, but not for $i \in J^{\prime}$. So, we have the following minimization equations for $w_{i}, i \in J$ :
$$
\begin{align*}
& \sum_{j \in J} C_{i j} w_{j}+\mu \eta_{i}+\widetilde{\mu} \alpha_{i}=0, \quad i \in J  \tag{168}\\
& \sum_{i \in J}\left|w_{i}\right|=1  \tag{169}\\
& \sum_{i \in J} \alpha_{i} w_{i}=\widetilde{P} \tag{170}
\end{align*}
$$
with $\mu$ and $\widetilde{\mu}$ determined using (169) and (170). There are additional conditions for the global minimum corresponding to the directions $i \in J^{\prime}$ :
$$
\begin{align*}
& \sum_{i, j=1}^{N} C_{i j}\left(w_{i}+\epsilon_{i}\right) \quad\left(w_{j}+\epsilon_{j}\right) \geq \sum_{i, j \in J} C_{i j} w_{i} w_{j}  \tag{171}\\
& \sum_{i=1}^{N}\left|w_{i}+\epsilon_{i}\right|=1  \tag{172}\\
& \sum_{i=1}^{N} \alpha_{i}\left(w_{i}+\epsilon_{i}\right)=\widetilde{P} \tag{173}
\end{align*}
$$
where $w_{i}, i \in J$ are determined using (168), while $w_{i}=0, i \in J^{\prime}$. The conditions (171) must be satisfied including for arbitrary infinitesimal $\epsilon_{i}$ subject to (172) and (173). For infinitesimal $\epsilon_{i}$ these conditions can be rewritten as follows: ${ }^{20}$
$$
\begin{align*}
& \sum_{i, j \in J} C_{i j} w_{i} \epsilon_{j}+\sum_{i \in J} \sum_{j \in J^{\prime}} C_{i j} w_{i} \epsilon_{j} \geq 0  \tag{174}\\
& \sum_{i \in J} \eta_{i} \epsilon_{i}+\sum_{i \in J^{\prime}}\left|\epsilon_{i}\right|=0  \tag{175}\\
& \sum_{i \in J} \alpha_{i} \epsilon_{i}+\sum_{i \in J^{\prime}} \alpha_{i} \epsilon_{i}=0 \tag{176}
\end{align*}
$$

\footnotetext{
${ }^{20}$ Since here $\epsilon_{i}$ are taken to be infinitesimal, these are the conditions for a local minimum. See Subsection 5.5 for the global minimum conditions.
}
which, taking into account (168), reduce to
$$
\begin{equation*}
\sum_{j \in J^{\prime}}\left(\sum_{i \in J} C_{i j} w_{i} \epsilon_{j}+\mu\left|\epsilon_{j}\right|+\widetilde{\mu} \alpha_{j} \epsilon_{j}\right) \geq 0 \tag{177}
\end{equation*}
$$

Since $\epsilon_{j}, j \in J^{\prime}$ are arbitrary, this gives the following conditions:
$$
\begin{equation*}
\forall j \in J^{\prime}: \quad\left|\widetilde{\mu} \alpha_{j}+\sum_{i \in J} C_{i j} w_{i}\right| \leq \mu \tag{178}
\end{equation*}
$$

These conditions must be satisfied by the solution to (168), (169) and (170). The solution that (locally) minimizes $g(w, \mu, \widetilde{\mu})$ is given by (in matrix notation)
$$
\begin{align*}
w & =-\mu D \eta-\widetilde{\mu} D \alpha  \tag{179}\\
\mu & =\frac{\widetilde{P}\left(\alpha^{T} D \eta\right)-\left(\alpha^{T} D \alpha\right)}{\left(\alpha^{T} D \alpha\right)\left(\eta^{T} D \eta\right)-\left(\alpha^{T} D \eta\right)^{2}}  \tag{180}\\
\widetilde{\mu} & =\frac{\left(\alpha^{T} D \eta\right)-\widetilde{P}\left(\eta^{T} D \eta\right)}{\left(\alpha^{T} D \alpha\right)\left(\eta^{T} D \eta\right)-\left(\alpha^{T} D \eta\right)^{2}} \tag{181}
\end{align*}
$$

Here all (both contracted and free) indices are assumed to run over $i \in J$, e.g.,
$$
\begin{equation*}
w_{i}=-\mu \sum_{j \in J} D_{i j} \eta_{j}-\widetilde{\mu} \sum_{j \in J} D_{i j} \alpha_{j}, \quad i \in J \tag{182}
\end{equation*}
$$
and $D$ is the inverse matrix of the $N(J) \times N(J)$ matrix $C_{i j}, i, j \in J$, where $N(J) \equiv$ $|J|$ is the number of elements of $J$ :
$$
\begin{equation*}
\sum_{k \in J} C_{i k} D_{k j}=\delta_{i j}, \quad i, j \in J \tag{183}
\end{equation*}
$$
i.e., $D$ is not a restriction of the inverse of the $N \times N$ matrix $C_{i j}, i, j \in 1, \ldots, N$ to $i, j \in J$.

Here the following observation is in order. In the above solution, a priori we do not know i) what the subset $J^{\prime}$ is and ii) what the values of $\eta_{i}$ are for $i \in J$. This means that a priori we have total of $3^{N}$ possible combinations (including the redundant empty $J$ case), so if we go through this finite set, we will solve the problem exactly. However, $3^{N}$ is a prohibitively large number, ${ }^{21}$ so one needs a more clever way of solving the problem. ${ }^{22}$

\footnotetext{
${ }^{21}$ We assume that $N$ itself is large.
${ }^{22}$ We need to iterate because of the term proportional to $\mu$ in (182). Let us assume $\mu=0$. Then for generic alpha configurations $J^{\prime}$ is empty, $D=C^{-1}$, and the solution is $w=\left(\alpha^{T} C^{-1} \eta\right)^{-1} C^{-1} \alpha$ with $\widetilde{P}=\left(\alpha^{T} C^{-1} \alpha\right) /\left(\alpha^{T} C^{-1} \eta\right)$, which corresponds to the solution to $S \rightarrow \max$ with $S=S_{\max }=$ $\sqrt{\alpha^{T} C^{-1} \alpha}$. We discuss this case in more detail in Subsection 5.3 in the context of the factor model covariance matrix.
}

\subsection*{5.1 Factor Model}

As was pointed out in [57] in the context of optimization with linear costs, a way to reduce the number of iterations in this types of problems is to reduce the "offdiagonality" of $C_{i j}$. This can be achieved by considering a factor model for alphas. ${ }^{23}$

\footnotetext{
${ }^{23}$ Here we simply assume a factor model form for the covariance matrix without delving into details of how it is constructed.
}

As in the case of a stock multi-factor risk model, instead of $N$ alphas, one deals with $F \ll N$ risk factors and the covariance matrix $C_{i j}$ is replaced by $\Gamma_{i j}$ given by
$$
\begin{align*}
& \Gamma \equiv \Xi+\Omega \Phi \Omega^{T} \equiv \Xi+\widetilde{\Omega} \widetilde{\Omega}^{T}  \tag{184}\\
& \Xi_{i j} \equiv \xi_{i}^{2} \delta_{i j}  \tag{185}\\
& \widetilde{\Phi} \widetilde{\Phi}^{T}=\Phi \tag{186}
\end{align*}
$$
where $\xi_{i}$ is the specific risk for each $\alpha_{i} ; \Omega_{i A}$ is an $N \times F$ factor loadings matrix; $\widetilde{\Omega} \equiv \Omega \widetilde{\Phi} ; \Phi_{A B}$ is the factor covariance matrix, $A, B=1, \ldots, F$; and $\widetilde{\Phi}_{A B}$ is the Cholesky decomposition of $\Phi_{A B}$, which is assumed to be positive-definite. I.e., the random processes $\Upsilon_{i}$ corresponding to $N$ alphas are modeled via $N$ random processes $z_{i}$ (corresponding to specific risk) together with $F$ random processes $f_{A}$ (corresponding to factor risk):
$$
\begin{align*}
& \Upsilon_{i}=z_{i}+\sum_{A=1}^{F} \Omega_{i A} f_{A}  \tag{187}\\
& \left\langle z_{i}, z_{j}\right\rangle=\Xi_{i j}  \tag{188}\\
& \left\langle z_{i}, f_{A}\right\rangle=0  \tag{189}\\
& \left\langle f_{A}, f_{B}\right\rangle=\Phi_{A B}  \tag{190}\\
& \left\langle\Upsilon_{i}, \Upsilon_{j}\right\rangle=\Gamma_{i j} \tag{191}
\end{align*}
$$

Instead of an $N \times N$ covariance matrix $C_{i j}$ we now have an $F \times F$ covariance matrix $\Phi_{A B}$. In the following we assume that $C_{i j}$ has the factor model form $\Gamma_{i j}$.

\subsection*{5.2 Optimization with Factor Model}

In this framework, the problem reduces to solving an $(F+2)$-dimensional system as follows. First, let
$$
\begin{equation*}
v_{A} \equiv \sum_{i=1}^{N} w_{i} \widetilde{\Omega}_{i A}=\sum_{i \in J} w_{i} \widetilde{\Omega}_{i A}, \quad A=1, \ldots, F \tag{192}
\end{equation*}
$$

Then from (168) we have
$$
\begin{equation*}
w_{i}=-\frac{1}{\xi_{i}^{2}}\left(\mu \eta_{i}+\widetilde{\mu} \alpha_{i}+\sum_{A=1}^{F} \widetilde{\Omega}_{i A} v_{A}\right), \quad i \in J \tag{193}
\end{equation*}
$$



Recalling that $w_{i} \eta_{i}>0, i \in J$, and assuming that $\mu \geq 0$ (see below), we get
$$
\begin{align*}
& \eta_{i}=-\operatorname{sign}\left(\widetilde{\mu} \alpha_{i}+\sum_{A=1}^{F} \widetilde{\Omega}_{i A} v_{A}\right), \quad i \in J  \tag{194}\\
& \forall i \in J: \quad\left|\widetilde{\mu} \alpha_{i}+\sum_{A=1}^{F} \widetilde{\Omega}_{i A} v_{A}\right|>\mu  \tag{195}\\
& \forall i \in J^{\prime}: \quad\left|\widetilde{\mu} \alpha_{i}+\sum_{A=1}^{F} \widetilde{\Omega}_{i A} v_{A}\right| \leq \mu \tag{196}
\end{align*}
$$
where (195) follows from (193), and (196) follows from (178). The last two inequalities define $J$ and $J^{\prime}$ in terms of $(F+2)$ unknowns $v_{A}, \mu$ and $\widetilde{\mu}$.

In the remainder of this subsection we assume that $\mu \geq 0$. We discuss the $\mu<0$ case in Subsection 5.4.

Substituting (193) into (192), (169) and (170), we get the following system of $(F+2)$ equations for $(F+2)$ unknowns $v_{A}, \mu$ and $\widetilde{\mu}$ :
$$
\begin{align*}
& \sum_{B=1}^{F} Q_{A B} v_{B}+a_{A} \mu+b_{A} \widetilde{\mu}=0  \tag{197}\\
& \sum_{A=1}^{F} a_{A} v_{A}+c \mu+d \widetilde{\mu}=-1  \tag{198}\\
& \sum_{A=1}^{F} b_{A} v_{A}+d \mu+e \widetilde{\mu}=-\widetilde{P} \tag{199}
\end{align*}
$$
where
$$
\begin{align*}
& Q_{A B} \equiv \delta_{A B}+\sum_{i \in J} \frac{\widetilde{\Omega}_{i A} \widetilde{\Omega}_{i B}}{\xi_{i}^{2}}  \tag{200}\\
& a_{A} \equiv \sum_{i \in J} \frac{\eta_{i} \widetilde{\Omega}_{i A}}{\xi_{i}^{2}}  \tag{201}\\
& b_{A} \equiv \sum_{i \in J} \frac{\alpha_{i} \widetilde{\Omega}_{i A}}{\xi_{i}^{2}}  \tag{202}\\
& c \equiv \sum_{i \in J} \frac{1}{\xi_{i}^{2}}  \tag{203}\\
& d \equiv \sum_{i \in J} \frac{\alpha_{i} \eta_{i}}{\xi_{i}^{2}}  \tag{204}\\
& e \equiv \sum_{i \in J} \frac{\alpha_{i}^{2}}{\xi_{i}^{2}} \tag{205}
\end{align*}
$$

Let $\widetilde{Q}_{a b}, a, b=1, \ldots,(F+2)$ be the following symmetric $(F+2) \times(F+2)$ matrix:
$$
\begin{align*}
& \widetilde{Q}_{A B} \equiv Q_{A B}  \tag{206}\\
& \widetilde{Q}_{A,(F+1)}=\widetilde{Q}_{(F+1), A} \equiv a_{A}  \tag{207}\\
& \widetilde{Q}_{A,(F+2)}=\widetilde{Q}_{(F+2), A} \equiv b_{A}  \tag{208}\\
& \widetilde{Q}_{(F+1),(F+1)} \equiv c  \tag{209}\\
& \widetilde{Q}_{(F+1),(F+2)}=\widetilde{Q}_{(F+2),(F+1)} \equiv d  \tag{210}\\
& \widetilde{Q}_{(F+2),(F+2)} \equiv e \tag{211}
\end{align*}
$$

Also, let $x_{a}$ and $y_{a}, a=1, \ldots,(F+2)$ be the following $(F+2)$-vectors:
$$
\begin{align*}
& x_{A} \equiv v_{A}  \tag{212}\\
& x_{F+1} \equiv \mu  \tag{213}\\
& x_{F+2} \equiv \widetilde{\mu}  \tag{214}\\
& y_{A}=0  \tag{215}\\
& y_{F+1}=-1  \tag{216}\\
& y_{F+2}=-\widetilde{P} \tag{217}
\end{align*}
$$

Then we have
$$
\begin{equation*}
x_{a}=\sum_{b=1}^{F+2} \widehat{Q}_{a b} y_{b} \tag{218}
\end{equation*}
$$
where $\widehat{Q}_{a b}$ is the matrix inverse to $\widetilde{Q}_{a b}: \widehat{Q} \equiv \widetilde{Q}^{-1}$.
Note that (218) solves for $v_{A}, \mu$ and $\widetilde{\mu}$ given $\eta_{i}, J$ and $J^{\prime}$. On the other hand, (194), (195) and (196) determine $\eta_{i}, J$ and $J^{\prime}$ in terms of $v_{A}, \mu$ and $\widetilde{\mu}$. The entire system is then solved iteratively, where at the initial iteration one takes $J^{(0)}=$ $\{1, \ldots, N\}$, so that $J^{\prime(0)}$ is empty, and
$$
\begin{equation*}
\eta_{i}^{(0)}= \pm 1, \quad i=1, \ldots, N \tag{219}
\end{equation*}
$$

While a priori the values of $\eta_{i}^{(0)}$ can be arbitrary, unless $F \ll N$, in some cases one might encounter convergence issues. However, if one chooses
$$
\begin{equation*}
\eta_{i}^{(0)}=\operatorname{sign}\left(\alpha_{i}\right), \quad i=1, \ldots, N \tag{220}
\end{equation*}
$$
then the iterative procedure generally is expected to converge rather fast. Furthermore, note that the solution is actually exact, i.e., the convergence criteria are given by (from Subsection 5.5 we have that for $\mu \geq 0$ this produces the global optimum)
$$
\begin{align*}
& J^{(s+1)}=J^{(s)}  \tag{221}\\
& \forall i \in J^{(s+1)}: \quad \eta_{i}^{(s+1)}=\eta_{i}^{(s)}  \tag{222}\\
& \mu^{(s+1)}=\mu^{(s)}  \tag{223}\\
& \widetilde{\mu}^{(s+1)}=\widetilde{\mu}^{(s)}  \tag{224}\\
& \forall A \in\{1, \ldots, F\}: \quad v_{A}^{(s+1)}=v_{A}^{(s)} \tag{225}
\end{align*}
$$
where $s$ and $s+1$ label successive iterations. ${ }^{24}$ Put differently, the iterative procedure is finite - it converges in a finite number of iterations. Finally, note that $w_{i}$ for $i \in J$ are given by (193), while $w_{i}=0$ for $i \in J^{\prime}$.

\footnotetext{
${ }^{24}$ The first two of these criteria are based on discrete quantities and are unaffected by computational (machine) precision effects, while the last three of these criteria are based on continuous quantities and in practice are understood as satisfied within computational (machine) precision. In practice, it suffices to check only one of the three continuous criteria, e.g., the convergence of $\mu$.
}

\subsection*{5.3 $\mu=0$ Case}

From the previous subsection we have
$$
\begin{align*}
& \mu=\frac{\widetilde{d} \widetilde{P}-\widetilde{e}}{\widetilde{c} \widetilde{e}-\widetilde{d}^{2}}  \tag{226}\\
& \widetilde{\mu}=\frac{\widetilde{d}-\widetilde{c} \widetilde{P}}{\widetilde{c} \widetilde{e}-\widetilde{d}^{2}}  \tag{227}\\
& 0<\widetilde{R}^{2}=\left.2 g\left(w_{i}, \mu, \widetilde{\mu}\right)\right|_{\text {optimum }}=-\mu-\widetilde{\mu} \widetilde{P}=\frac{\widetilde{c}^{2} \widetilde{P}^{2}-2 \widetilde{d} \widetilde{P}+\widetilde{e}}{\widetilde{c} \widetilde{e}-\widetilde{d^{2}}} \tag{228}
\end{align*}
$$
where
$$
\begin{align*}
& \widetilde{c} \equiv c-a^{T} Q^{-1} a=\sum_{i, j \in J} C_{i j}^{-1} \eta_{i} \eta_{j}>0  \tag{229}\\
& \widetilde{d} \equiv d-b^{T} Q^{-1} a=\sum_{i, j \in J} C_{i j}^{-1} \alpha_{i} \eta_{j}  \tag{230}\\
& \widetilde{e} \equiv e-b^{T} Q^{-1} b=\sum_{i, j \in J} C_{i j}^{-1} \alpha_{i} \alpha_{j}>0  \tag{231}\\
& C_{i j}^{-1}=\frac{1}{\xi_{i}^{2}} \delta_{i j}-\sum_{A, B=1}^{F} \frac{\widetilde{\Omega}_{i A}}{\xi_{i}^{2}} \frac{\widetilde{\Omega}_{i B}}{\xi_{j}^{2}} Q_{A B}^{-1} \tag{232}
\end{align*}
$$
and $Q_{A B}^{-1}$ is the inverse of $Q_{A B} \cdot{ }^{25}$ Note that if $\mu \geq 0$, then $\widetilde{\mu}<0$ assuming $\widetilde{P}=0$.
From (226) for $\mu=0$ we have
$$
\begin{align*}
& \widetilde{P}=\widetilde{P}_{*} \equiv \frac{\widetilde{e}}{\widetilde{d}}>0  \tag{233}\\
& \widetilde{\mu}=-\frac{1}{\widetilde{d}}<0 \tag{234}
\end{align*}
$$

We will now show that this corresponds to the weights $\widetilde{w}_{i}$ that maximize the Sharpe ratio: $S \rightarrow$ max. (We will denote this maximal value of the Sharpe ratio via $S_{\max }$.)

\footnotetext{
${ }^{25}$ Note that, because $C_{i j}$ has the factor model form, in this case the $N(J) \times N(J)$ matrix $D$ defined in (183) coincides with the restriction of the inverse of the $N \times N$ matrix $C_{i j}, i, j \in 1, \ldots, N$ to $i, j \in J$.
}

These weights are given by
$$
\begin{equation*}
\widetilde{w}_{i}=\gamma \sum_{i=1}^{N} C_{i j}^{-1} \alpha_{j}=\frac{\gamma}{\xi_{i}^{2}}\left(\alpha_{i}-\sum_{j=1}^{N} \frac{\alpha_{j}}{\xi_{j}^{2}} \sum_{A, B=1}^{F} \widetilde{\Omega}_{i A} \widetilde{\Omega}_{j B} Q_{A B}^{-1}\right) \tag{235}
\end{equation*}
$$
where $\gamma$ is fixed by (3). So we have $\left(\widetilde{\eta}_{i} \equiv \operatorname{sign}\left(\widetilde{w}_{i}\right)\right)$ :
$$
\begin{align*}
& \left.\widetilde{P}\right|_{S=S_{\max }}=\sum_{i=1}^{N} \alpha_{i} \widetilde{w}_{i}=\gamma\left(e-\sum_{A, B=1}^{F} Q_{A B}^{-1} b_{A} b_{B}\right)=\gamma \widetilde{e}  \tag{236}\\
& 1=\sum_{i=1}^{N} \widetilde{\eta}_{i} \widetilde{w}_{i}=\gamma\left(d-\sum_{A, B=1}^{F} Q_{A B}^{-1} a_{A} b_{B}\right)=\gamma \widetilde{d} \tag{237}
\end{align*}
$$
and we have (233). ${ }^{26}$ Note that in this case generically $J^{\prime}$ is empty and $\widetilde{w}_{i}$ can only vanish "accidentally" for those alphas such that the expression in the parenthesis in (235) vanishes. In the following we will assume that such "accidental" vanishings do not take place, i.e., let us consider generic alpha configurations. Also, we will denote the values of $\widetilde{c}, \widetilde{d}$ and $\widetilde{e}$ at $S=S_{\max }$ via $\widetilde{c}_{*}>0, \widetilde{d}_{*}>0$ and $\widetilde{e}_{*}>0$. The second inequality follows from (234).

\footnotetext{
${ }^{26}$ The reason why $\mu=0$ corresponds to $S \rightarrow$ max can be understood by noting that for $\mu \neq 0$ the term proportional to $\mu$ in (164) breaks the scaling property that $g \rightarrow \lambda^{2} g$ under $w_{i} \rightarrow \lambda w_{i}$, $\widetilde{\mu} \rightarrow \lambda \widetilde{\mu}$ and $\widetilde{P} \rightarrow \lambda \widetilde{P}$.
}

Next, note that we can focus on the values of $\widetilde{P} \geq \widetilde{P}_{*}$. Indeed, it makes no sense to consider $\widetilde{P}<\widetilde{P}_{*}$ as we have a solution with higher P\&L and higher Sharpe ratio, namely, the $S=S_{\text {max }}$ solution. Further, let us consider a solution with $\widetilde{P}=(1+\delta) \widetilde{P}_{*}$, where $0<\delta \ll 1$. Then $w_{i}=\left(1+\xi_{i}\right) \widetilde{w}_{i}$, where $\left|\xi_{i}\right| \ll 1$ and we have taken into account that none of the $\widetilde{w}_{i}$ vanishes. We then have $\eta_{i}=\widetilde{\eta}_{i}$, and the values of $\widetilde{c}, \widetilde{d}$ and $\widetilde{e}$ for $w_{i}$ are the same as for $\widetilde{w}_{i}$. So we have
$$
\begin{align*}
\mu & =\frac{\widetilde{e}_{*}}{\widetilde{c}_{*} \widetilde{e}_{*}-\widetilde{d}_{*}^{2}} \delta  \tag{238}\\
\widetilde{\mu} & =-\frac{1+\widetilde{c}_{*} \mu}{\widetilde{d}_{*}}  \tag{239}\\
\widetilde{R}^{2} & =\frac{\widetilde{e}_{*}}{\widetilde{d}_{*}^{2}}\left(1+\widetilde{c}_{*} \mu \delta\right) \tag{240}
\end{align*}
$$

Since for $\delta>0$ the $\mathrm{P} \& \mathrm{~L}$ increases, the volatility cannot decrease as $\delta=0$ corresponds to $S=S_{\max }$. It then follows from (240) that $\mu>0$ for $0<\delta \ll 1$ as we have $\widetilde{c}_{*}>0$.

Note that $\mu=0$ uniquely corresponds to the $S=S_{\max }$ solution, so $\mu$ cannot become zero at any $\widetilde{P}>\widetilde{P}_{*}$. Therefore, as we smoothly increase $\widetilde{P}$, the only way $\mu$ can become negative is via a discontinuity in $\widetilde{c}$, $\widetilde{d}$ and $\widetilde{e}$, i.e., for some $\widetilde{P}=\widetilde{P}_{1}>\widetilde{P}_{*}$ we have $\mu=\mu_{1}>0$ with one or more vanishing $w_{i}$, i.e., $J^{\prime} \equiv J_{1}^{\prime}$ is not empty, while for $\widetilde{P}=(1+\delta) \widetilde{P}_{1}$, where $|\delta| \ll 1$, we have empty $J^{\prime}$ and $\mu=\mu_{2}(\delta)<0$. This would imply that as $\delta \rightarrow 0$, we would have $w_{i} \rightarrow 0$ for $i \in J_{1}^{\prime}$ with non-vanishing $\mu=\mu_{2}(0)<0$, which is impossible. (Note that $\widetilde{c}, \widetilde{d}$ and $\widetilde{e}$ are unchanged as $\delta \rightarrow 0$.) Also, $\mu>0$ and $J^{\prime}$ is not empty as $\widetilde{P} \rightarrow \max \left(\alpha_{i}\right)$. Finally, note that $\mu<0$ is compatible with $\widetilde{P}<\widetilde{P}_{*}$ as no $w_{i}$ have to vanish for $\mu$ to become 0 as $\widetilde{P} \rightarrow \widetilde{P}_{*}-$.

\subsection*{5.4 $\mu<0$ case}

If $\mu<0$, then we no longer have (194) and (195). Instead, from (178) it follows that $J^{\prime}$ is empty and $J=\{1, \ldots, N\}$, i.e., there are no vanishing $w_{i}$, and we have
$$
\begin{align*}
& \mu<0  \tag{241}\\
& w_{i}=\frac{1}{\xi_{i}^{2}}\left(\eta_{i}|\mu|+z_{i}\right), \quad i=1, \ldots, N  \tag{242}\\
& z_{i} \equiv-\left(\widetilde{\mu} \alpha_{i}+\sum_{A=1}^{F} \widetilde{\Omega}_{i A} v_{A}\right), \quad i=1, \ldots, N \tag{243}
\end{align*}
$$

It then follows that
$$
\begin{align*}
& \eta_{i}=\operatorname{sign}\left(z_{i}\right), \quad i \in \widetilde{J}  \tag{244}\\
& \forall i \in \widetilde{J}: \quad\left|z_{i}\right| \geq|\mu| \tag{245}
\end{align*}
$$

However, $\eta_{i}$ can be 1 or -1 for $i \notin \widetilde{J}$, i.e., it is undetermined.
This is because for $\mu<0$ generically there are expected to be more than one local minima. This is problematic in two ways. First, it makes finding the global minimum more difficult due to the usual instabilities in any iterative procedure, especially when the number of local minima is large. Second, in the presence of a large number of local minima, the system is more prone to the out-of-sample instability as relatively small fluctuations in the off-diagonal elements of $C_{i j}$ can lead to an iterative algorithm jumping between local minima. However, as we discussed above, $\mu<0$ luckily corresponds to the uninteresting range $\widetilde{P}<\widetilde{P}_{*}$.

\subsection*{5.5 Conditions for Global Minimum}

Above we gave the conditions for the global minimum:
$$
\begin{align*}
& \sum_{i, j=1}^{N} C_{i j}\left(w_{i}+\epsilon_{i}\right) \quad\left(w_{j}+\epsilon_{j}\right) \geq \sum_{i, j \in J} C_{i j} w_{i} w_{j}  \tag{246}\\
& \sum_{i=1}^{N}\left|w_{i}+\epsilon_{i}\right|=1  \tag{247}\\
& \sum_{i=1}^{N} \alpha_{i}\left(w_{i}+\epsilon_{i}\right)=\widetilde{P} \tag{248}
\end{align*}
$$
where $w_{i}, i \in J$ are determined using (168), while $w_{i}=0, i \in J^{\prime}$, and $\epsilon_{i}$ are arbitrary subject to (247) and (248). Above we discussed these conditions for arbitrary infinitesimal $\epsilon_{i}$, which give the conditions for a local minimum. Here we discuss the above conditions for non-infinitesimal $\epsilon_{i}$. We have
$$
\begin{align*}
& \sum_{i, j=1}^{N} C_{i j} \epsilon_{i} \epsilon_{j}+2 \sum_{i, j \in J} C_{i j} w_{i} \epsilon_{j}+2 \sum_{i \in J} \sum_{j \in J^{\prime}} C_{i j} w_{i} \epsilon_{j} \geq 0  \tag{249}\\
& \sum_{i \in J}\left(\left|w_{i}+\epsilon_{i}\right|-\left|w_{i}\right|\right)+\sum_{i \in J^{\prime}}\left|\epsilon_{i}\right|=0  \tag{250}\\
& \sum_{i \in J} \alpha_{i} \epsilon_{i}+\sum_{i \in J^{\prime}} \alpha_{i} \epsilon_{i}=0 \tag{251}
\end{align*}
$$
which, taking into account (168) and (177), reduce to
$$
\begin{equation*}
\sum_{i, j=1}^{N} C_{i j} \epsilon_{i} \epsilon_{j} \geq 2 \mu\left(\sum_{i \in J} \eta_{i} \epsilon_{i}+\sum_{i \in J^{\prime}}\left|\epsilon_{i}\right|\right) \tag{252}
\end{equation*}
$$

Note that for infinitesimal $\epsilon_{i}$ the r.h.s. of (252) vanishes due to (250), while the l.h.s. is positive due to positive-definiteness of $C_{i j}$. However, for non-infinitesimal $\epsilon_{i}$ we have nontrivial conditions.

Let us define $J_{1} \subset J$ and $J_{2} \subset J$ as follows:
$$
\begin{array}{ll}
\eta_{i}\left(w_{i}+\epsilon_{i}\right) \geq 0, & i \in J_{1} \\
\eta_{i}\left(w_{i}+\epsilon_{i}\right)<0, & i \in J_{2} \tag{254}
\end{array}
$$

Then, from (250) we have
$$
\begin{equation*}
\sum_{i \in J} \eta_{i} \epsilon_{i}+\sum_{i \in J^{\prime}}\left|\epsilon_{i}\right|=-2 \sum_{i \in J_{2}}\left|w_{i}+\epsilon_{i}\right| \tag{255}
\end{equation*}
$$
and
$$
\begin{equation*}
\sum_{i, j=1}^{N} C_{i j} \epsilon_{i} \epsilon_{j} \geq-4 \mu \sum_{i \in J_{2}}\left|w_{i}+\epsilon_{i}\right| \tag{256}
\end{equation*}
$$

This condition is always satisfied for $\mu \geq 0$, which implies that the solution to the local optimum conditions discussed above is automatically the global optimum. However, for $\mu<0$ (256) implies that a solution to the local optimum conditions is not guaranteed to be the global optimum. In fact, as we discuss in Subsection 5.4, for $\mu<0$ we can have multiple local minima.

\subsection*{5.6 General Case}

The methods employed in the context of the factor model can be used to tackle the case of a general covariance matrix with the understanding that, as we discuss below, convergence of an iterative procedure in the general case is tricky.

We want to solve (168) subject to (169) and (170) for a general positive-definite covariance matrix $C_{i j}$ (assuming $C_{i i}>0$ ). From (168) we have
$$
\begin{align*}
w_{i} & =-\frac{1}{C_{i i}}\left(\mu \eta_{i}+\widetilde{\mu} \alpha_{i}+v_{i}\right), \quad i \in J  \tag{257}\\
v_{i} & \equiv \sum_{j \in J(i)} C_{i j} w_{j}, \quad i \in J  \tag{258}\\
J(i) & \equiv J \backslash\{i\} \tag{259}
\end{align*}
$$
i.e., $J(i)$ is defined as $J$ with the single-element subset $\{i\}$ subtracted, and $J$ (and $J^{\prime}$ ) are defined as above. Let
$$
\begin{align*}
Q_{i j} & \equiv \frac{C_{i j}}{C_{j j}}, \quad i, j \in J  \tag{260}\\
a_{i} & \equiv \sum_{j \in J(i)} Q_{i j} \eta_{j}=\sum_{j \in J} Q_{i j} \eta_{j}-\eta_{i}, \quad i \in J  \tag{261}\\
b_{i} & \equiv \sum_{j \in J(i)} Q_{i j} \alpha_{j}=\sum_{j \in J} Q_{i j} \alpha_{j}-\alpha_{i}, \quad i \in J  \tag{262}\\
\widetilde{a}_{i} & \equiv \frac{\eta_{i}}{C_{i i}}, \quad i \in J  \tag{263}\\
\widetilde{b}_{i} & \equiv \frac{\alpha_{i}}{C_{i i}}, \quad i \in J  \tag{264}\\
c & \equiv \sum_{i \in J} \frac{1}{C_{i i}}  \tag{265}\\
d & \equiv \sum_{i \in J} \frac{\alpha_{i} \eta_{i}}{C_{i i}}  \tag{266}\\
e & \equiv \sum_{i \in J} \frac{\alpha_{i}^{2}}{C_{i i}} \tag{267}
\end{align*}
$$

Then, by plugging (257) into (258), (169) and (170), we obtain the following system of $N(J)+2$ equations for $N(J)+2$ unknowns $v_{i}, \mu$ and $\widetilde{\mu}:{ }^{27}$
$$
\begin{align*}
& \sum_{j \in J} Q_{i j} v_{j}+a_{i} \mu+b_{i} \widetilde{\mu}=0, \quad i \in J  \tag{268}\\
& \sum_{i \in J} \widetilde{a}_{i} v_{i}+c \mu+d \widetilde{\mu}=0  \tag{269}\\
& \sum_{i \in J} \widetilde{b}_{i} v_{i}+d \mu+e \widetilde{\mu}=0 \tag{270}
\end{align*}
$$

\footnotetext{
${ }^{27}$ Recall the definition of $N(J) \equiv|J|$.
}

Let $\widetilde{Q}_{a b}, a, b=1, \ldots,(N(J)+2)$ be the following $(N(J)+2) \times(N(J)+2)$ matrix:
$$
\begin{align*}
& \widetilde{Q}_{i j} \equiv Q_{i j}, \quad i, j \in J  \tag{271}\\
& \widetilde{Q}_{i,(N(J)+1)} \equiv a_{i}, \quad i \in J  \tag{272}\\
& \widetilde{Q}_{(N(J)+1), i} \equiv \widetilde{a}_{i}, \quad i \in J  \tag{273}\\
& \widetilde{Q}_{i,(N(J)+2)} \equiv b_{i}, \quad i \in J  \tag{274}\\
& \widetilde{Q}_{(N(J)+2), i} \equiv \widetilde{b}_{i}, \quad i \in J  \tag{275}\\
& \widetilde{Q}_{(N(J)+1),(N(J)+1)} \equiv c  \tag{276}\\
& \widetilde{Q}_{(N(J)+1),(N(J)+2)}=\widetilde{Q}_{(N(J)+2),(N(J)+1)} \equiv d  \tag{277}\\
& \widetilde{Q}_{(N(J)+2),(N(J)+2)} \equiv e \tag{278}
\end{align*}
$$

Note that $Q_{a b}$ is not symmetric. Also, let $x_{a}$ and $y_{a}, a=1, \ldots,(N(J)+2)$ be the following $(N(J)+2)$-vectors:
$$
\begin{align*}
& x_{i} \equiv v_{i}, \quad i \in J  \tag{279}\\
& x_{N(J)+1} \equiv \mu  \tag{280}\\
& x_{N(J)+2} \equiv \widetilde{\mu}  \tag{281}\\
& y_{i}=0, \quad i \in J  \tag{282}\\
& y_{N(J)+1}=-1  \tag{283}\\
& y_{N(J)+2}=-\widetilde{P} \tag{284}
\end{align*}
$$

Then we have
$$
\begin{equation*}
x_{a}=\sum_{b=1}^{N(J)+2} \widehat{Q}_{a b} y_{b} \tag{285}
\end{equation*}
$$
where $\widehat{Q}_{a b}$ is the matrix inverse ${ }^{28}$ to $\widetilde{Q}_{a b}: \widehat{Q} \equiv \widetilde{Q}^{-1}$.
Next, recalling that $\eta_{i} w_{i}>0, i \in J$, using (257) and assuming $\mu \geq 0$ we have
$$
\begin{align*}
& \mu \geq 0  \tag{286}\\
& \eta_{i}=-\operatorname{sign}\left(\widetilde{\mu} \alpha_{i}+v_{i}\right), \quad i \in J  \tag{287}\\
& \forall i \in J: \quad\left|\widetilde{\mu} \alpha_{i}+v_{i}\right|>\mu  \tag{288}\\
& \forall i \in J^{\prime}: \quad\left|\widetilde{\mu} \alpha_{i}+v_{i}\right| \leq \mu \tag{289}
\end{align*}
$$
where the last condition follows from (178). The last three conditions determine $\eta_{i}$, $J$ and $J^{\prime}$ in terms of $v_{i}, \mu$ and $\widetilde{\mu}$, while (285) solves $v_{i}, \mu$ and $\widetilde{\mu}$ given $\eta_{i}, J$ and $J^{\prime}$. So, one can attempt to solve the entire system iteratively as in the context of the factor model in Subsection 5.2. In this regard, the $N(J)$-vector $v_{i}$ here is analogous to the $F$-vector $v_{A}$ in Subsection 5.2. However, unless $N(J) \ll N$, the analogy with the factor model is only superficial and the convergence is not guaranteed.

\footnotetext{
${ }^{28}$ This inverse exists so long as $C_{i j}$ is invertible, which we assume to be the case.
}

\section*{6 Linear Cost in Weight Optimization}

Next, let us include linear cost in the weight optimization problem. Linear costs can be modeled by subtracting a linear penalty from the $\mathrm{P} \& \mathrm{~L}$ :
$$
\begin{equation*}
P=I \sum_{i=1}^{N} \alpha_{i} w_{i}-L D \tag{290}
\end{equation*}
$$
where $L$ includes all fixed trading costs (SEC fees, exchange fees, broker-dealer fees, etc.) and linear slippage. ${ }^{29}$ The linear cost assumes no impact, i.e., trading does not affect the stock prices. Also, $D=I T$ is the dollar amount traded, and $T$ is the turnover (so the turnover is defined as a percentage). Let $\tau_{i}$ be the turnovers corresponding to individual alphas $\alpha_{i}$. If we ignore turnover reduction resulting from combining alphas (or if the internal crossing is switched off), then
$$
\begin{equation*}
T=\sum_{i=1}^{N} \tau_{i}\left|w_{i}\right| \tag{291}
\end{equation*}
$$

\footnotetext{
${ }^{29}$ Here for the sake of simplicity the linear slippage is assumed to be uniform across all alphas. This is not a critical assumption and can be relaxed, e.g., by modifying the definition of $L_{i}$ below. In essence, this assumption is made to simplify the discussion of turnover reduction.
}


However, with internal crossing turnover reduction can be substantial and needs to be taken into account. In [58] we proposed a model of turnover reduction, according to which when the number of alphas $N$ is large, the leading approximation (in the $1 / N$ expansion) is given by
$$
\begin{equation*}
T \approx \rho_{*} \sum_{i=1}^{N} \tau_{i}\left|w_{i}\right| \tag{292}
\end{equation*}
$$
where $0<\rho_{*} \leq 1$ is the turnover reduction coefficient. Let us emphasize that this formula is expected to be a good approximation in the large $N$ limit (so long as the distribution of individual turnovers $\tau_{i}$ is not skewed) regardless of how $\rho_{*}$ is modeled. In [58] we also proposed a spectral model for estimating $\rho_{*}$ based on the correlation matrix $\Psi_{i j}$ :
$$
\begin{equation*}
\rho_{*} \approx \frac{\psi^{(1)}}{N \sqrt{N}}\left|\sum_{i=1}^{N} \widetilde{V}_{i}^{(1)}\right| \tag{293}
\end{equation*}
$$
where $\psi^{(1)}$ is the largest eigenvalue of $\Psi_{i j}$ and $\widetilde{V}_{i}^{(1)}$ is the corresponding eigenvector normalized such that $\sum_{i=1}^{N}\left(\widetilde{V}_{i}^{(1)}\right)^{2}=1$.

We then have
$$
\begin{equation*}
P=I \sum_{i=1}^{N}\left(\alpha_{i} w_{i}-L_{i}\left|w_{i}\right|\right) \tag{294}
\end{equation*}
$$
where
$$
\begin{equation*}
L_{i} \equiv L \rho_{*} \tau_{i}>0 \tag{295}
\end{equation*}
$$

We then follow the approach of Section 5, which is now modified as follows.
For the sake of brevity, we will not repeat the discussions of Section 5 whose applicability is evident, and we will use the same notations as in Section 5 and simply modify the corresponding definitions. Furthermore, we will assume the factor model of Subsection 5.1. We need to solve the following problem:
$$
\begin{align*}
\frac{P}{I} & =\sum_{i=1}^{N}\left(\alpha_{i} w_{i}-L_{i}\left|w_{i}\right|\right) \equiv \widetilde{P}=\text { fixed }  \tag{296}\\
\frac{R}{I} & =\sqrt{\sum_{i, j=1}^{N} C_{i j} w_{i} w_{j}} \rightarrow \min \tag{297}
\end{align*}
$$
subject to
$$
\begin{equation*}
\sum_{i=1}^{N}\left|w_{i}\right|=1 \tag{298}
\end{equation*}
$$

This problem can be stated as follows:
$$
\begin{align*}
& g(w, \mu, \widetilde{\mu}) \equiv \frac{1}{2} \sum_{i, j=1}^{N} C_{i j} w_{i} w_{j}+ \\
& \quad+\mu\left(\sum_{i=1}^{N}\left|w_{i}\right|-1\right)+\widetilde{\mu}\left(\sum_{i=1}^{N}\left(\alpha_{i} w_{i}-L_{i}\left|w_{i}\right|\right)-\widetilde{P}\right) \rightarrow \min \tag{299}
\end{align*}
$$

We now have
$$
\begin{align*}
w_{i} & =-\frac{1}{\xi_{i}^{2}}\left(\mu \eta_{i}+\widetilde{\mu} \bar{\alpha}_{i}+\sum_{A=1}^{F} \widetilde{\Omega}_{i A} v_{A}\right), \quad i \in J  \tag{300}\\
\bar{\alpha}_{i} & \equiv \alpha_{i}-L_{i} \eta_{i}, \quad i \in J \tag{301}
\end{align*}
$$

Recalling that we have $w_{i} \eta_{i}>0, i \in J$, and assuming that $\mu \geq \widetilde{\mu} L_{i}, i \in J$ we get
$$
\begin{align*}
& \mu \geq \widetilde{\mu} L_{i}, \quad i=1, \ldots, N  \tag{302}\\
& \eta_{i}=-\operatorname{sign}\left(\widetilde{\mu} \alpha_{i}+\sum_{A=1}^{F} \widetilde{\Omega}_{i A} v_{A}\right), \quad i \in J  \tag{303}\\
& \forall i \in J: \quad\left|\widetilde{\mu} \alpha_{i}+\sum_{A=1}^{F} \widetilde{\Omega}_{i A} v_{A}\right|>\mu-\widetilde{\mu} L_{i}  \tag{304}\\
& \forall i \in J^{\prime}: \quad\left|\widetilde{\mu} \alpha_{i}+\sum_{A=1}^{F} \widetilde{\Omega}_{i A} v_{A}\right| \leq \mu-\widetilde{\mu} L_{i} \tag{305}
\end{align*}
$$

Note that $\mu \geq \widetilde{\mu} L_{i}, i \in J^{\prime}$ follows from (305). ${ }^{30}$

\footnotetext{
30 The global minimum conditions in the presence of linear costs are discussed in Subsection 6.1, where we also derive the above conditions for a local minimum.
}

The rest of the discussion is identical to that in Subsection 5.2 with $\alpha_{i}$ replaced by $\bar{\alpha}_{i}$ in all the remaining definitions. We still have (226), (227) and (228), so for $\mu \geq 0$ we still have $\widetilde{\mu}<0$, which implies that the condition (302) is automatically satisfied for $\mu \geq 0$. I.e., the condition for the existence of the unique minimum with the linear costs $\left(\mu \geq \widetilde{\mu} L_{i}\right)$ is not as strong as in the absence of costs $(\mu \geq 0)$. Furthermore, $\mu=0$ still corresponds to maximizing the Sharpe ratio $S \rightarrow \max$ with linear costs [57]. Let the corresponding $\widetilde{P} \equiv \widetilde{P}_{*}$. Then we can restrict to $\widetilde{P} \geq \widetilde{P}_{*}$, for which we have $\mu \geq 0$, which means that the results of Subsection 5.2 apply.

Here the following remark is in order. Because the alphas $\alpha_{i}, i \in J^{\prime}$ are no longer traded, we can drop such alphas, if any, recompute $\rho_{*}$ in (295) using the corresponding correlation matrix $\left.\Psi_{i j}^{\prime} \equiv \Psi_{i j}\right|_{i, j \in J}$, recompute $w_{i}$ using such $\rho_{*}$ and repeat this procedure until the subset $J$ based on which $\rho_{*}$ is computed is the same as the subset for which $w_{i} \neq 0$, where $w_{i}$ are computed based on such $\rho_{*} .{ }^{31}$

\footnotetext{
${ }^{31}$ When $N$ is large, this procedure is stable and convergent as $\rho_{*}$ does not change much with $N($ see [58]).
}

\subsection*{6.1 Global Minimum Conditions with Linear Costs}

The discussion in Subsection 5.5 is modified as follows in the presence of linear costs. We have
$$
\begin{align*}
& \sum_{i, j=1}^{N} C_{i j}\left(w_{i}+\epsilon_{i}\right) \quad\left(w_{j}+\epsilon_{j}\right) \geq \sum_{i, j \in J} C_{i j} w_{i} w_{j}  \tag{306}\\
& \sum_{i=1}^{N}\left|w_{i}+\epsilon_{i}\right|=1  \tag{307}\\
& \sum_{i=1}^{N}\left(\alpha_{i}\left(w_{i}+\epsilon_{i}\right)-L_{i}\left|w_{i}+\epsilon_{i}\right|\right)=\widetilde{P} \tag{308}
\end{align*}
$$
where $w_{i}, i \in J$ are determined via
$$
\begin{equation*}
\sum_{j \in J} C_{i j} w_{j}=-\mu \eta_{i}-\widetilde{\mu}\left(\alpha_{i}-L_{i} \eta_{i}\right), \quad i \in J \tag{309}
\end{equation*}
$$
while $w_{i}=0, i \in J^{\prime}$. We have
$$
\begin{align*}
& \sum_{i, j=1}^{N} C_{i j} \epsilon_{i} \epsilon_{j}+2 \sum_{i, j \in J} C_{i j} w_{i} \epsilon_{j}+2 \sum_{i \in J} \sum_{j \in J^{\prime}} C_{i j} w_{i} \epsilon_{j} \geq 0  \tag{310}\\
& \sum_{i \in J}\left(\left|w_{i}+\epsilon_{i}\right|-\left|w_{i}\right|\right)+\sum_{i \in J^{\prime}}\left|\epsilon_{i}\right|=0  \tag{311}\\
& \sum_{i \in J}\left(\alpha_{i} \epsilon_{i}-L_{i}\left(\left|w_{i}+\epsilon_{i}\right|-\left|w_{i}\right|\right)\right)+\sum_{i \in J^{\prime}}\left(\alpha_{i} \epsilon_{i}-L_{i}\left|\epsilon_{i}\right|\right)=0 \tag{312}
\end{align*}
$$


which, taking into account (309), reduce to
$$
\begin{align*}
& \sum_{i, j=1}^{N} C_{i j} \epsilon_{i} \epsilon_{j}+2 \sum_{j \in J^{\prime}}\left(\sum_{i \in J} C_{i j} w_{i} \epsilon_{j}+\left(\mu-\widetilde{\mu} L_{j}\right)\left|\epsilon_{j}\right|+\widetilde{\mu} \alpha_{j} \epsilon_{j}\right) \geq \\
& \quad \geq-4 \sum_{i \in J_{2}}\left(\mu-\widetilde{\mu} L_{i}\right)\left|w_{i}+\epsilon_{i}\right| \tag{313}
\end{align*}
$$
where, as above, $J_{2}$ is defined as follows:
$$
\begin{equation*}
\eta_{i}\left(w_{i}+\epsilon_{i}\right)<0, \quad i \in J_{2} \subset J \tag{314}
\end{equation*}
$$

For infinitesimal $\epsilon_{i}$ we have empty $J_{2}$ and (313) reduces to
$$
\begin{equation*}
\sum_{j \in J^{\prime}}\left(\sum_{i \in J} C_{i j} w_{i} \epsilon_{j}+\left(\mu-\widetilde{\mu} L_{j}\right)\left|\epsilon_{j}\right|+\widetilde{\mu} \alpha_{j} \epsilon_{j}\right) \geq 0 \tag{315}
\end{equation*}
$$
which gives
$$
\begin{equation*}
\forall j \in J^{\prime}: \quad\left|\sum_{i \in J} C_{i j} w_{i}+\widetilde{\mu} \alpha_{j}\right| \leq \mu-\widetilde{\mu} L_{j} \tag{316}
\end{equation*}
$$
which in turn gives (305) in the factor model context.
For non-infinitesimal $\epsilon_{i}$ we have the following condition:
$$
\begin{equation*}
\sum_{i, j=1}^{N} C_{i j} \epsilon_{i} \epsilon_{j} \geq-4 \sum_{i \in J_{2}}\left(\mu-\widetilde{\mu} L_{i}\right)\left|w_{i}+\epsilon_{i}\right| \tag{317}
\end{equation*}
$$
which is always satisfied if
$$
\begin{equation*}
\mu \geq \widetilde{\mu} L_{i}, \quad i \in J \tag{318}
\end{equation*}
$$

In this case the solution to the local optimum conditions discussed above is automatically the global optimum. However, if (318) is not satisfied, then a solution to the local optimum conditions is not guaranteed to be the global optimum. In fact, in this case we can have multiple local minima.

\section*{7 Impact in Weight Optimization}

Finally, let us discuss the effect of impact, i.e., nonlinear costs, on weight optimization. Generally, introducing nonlinear impact makes the weight optimization problem computationally more challenging and requires introduction of approximation methods.

One way of modeling trading costs is to introduce linear and nonlinear terms:
$$
\begin{equation*}
P=I \sum_{i=1}^{N} \alpha_{i} w_{i}-L D-\frac{1}{n} Q D^{n} \tag{319}
\end{equation*}
$$
where $D=I T$ is the dollar amount traded, and $T$ is the turnover. If we model turnover using (292), then we have
$$
\begin{equation*}
P=I \sum_{i=1}^{N}\left(\alpha_{i} w_{i}-L_{i}\left|w_{i}\right|\right)-\frac{1}{n} \widetilde{Q}\left(\sum_{i=1}^{N} \tau_{i}\left|w_{i}\right|\right)^{n} \tag{320}
\end{equation*}
$$
where the modulus accounts for the possibility of some $w_{i}$ being negative, and $\widetilde{Q}$ is defined as follows
$$
\begin{equation*}
\widetilde{Q} \equiv Q\left(I \rho_{*}\right)^{n} \tag{321}
\end{equation*}
$$

For general fractional $n$, which would have to be measured empirically, the weight optimization problem would have to be solved numerically.

First, note that if individual turnovers $\tau_{i} \equiv \tau$ are identical, then the nonlinear cost contribution into $P$ is independent of $w_{i}$ as we have (3). In this case, it simply shifts $\widetilde{P}$ by a constant and the problem can be solved exactly as in the previous section. ${ }^{32}$ If $\tau_{i}$ are not all identical, then we need to solve the following problem:
$$
\begin{align*}
& g(w, \mu, \widetilde{\mu}) \equiv \frac{1}{2} \sum_{i, j=1}^{N} C_{i j} w_{i} w_{j}+\mu\left(\sum_{i=1}^{N}\left|w_{i}\right|-1\right)+ \\
& \quad+\widetilde{\mu}\left[\sum_{i=1}^{N}\left(\alpha_{i} w_{i}-L_{i}\left|w_{i}\right|\right)-\frac{1}{n} \widetilde{Q}^{\prime}\left(\sum_{i=1}^{N} \tau_{i}\left|w_{i}\right|\right)^{n}-\widetilde{P}\right]  \tag{322}\\
& g(w, \mu, \widetilde{\mu}) \rightarrow \min \tag{323}
\end{align*}
$$
where
$$
\begin{equation*}
\widetilde{Q}^{\prime} \equiv \frac{\widetilde{Q}}{I} \tag{324}
\end{equation*}
$$

\footnotetext{
${ }^{32}$ In fact, in this case the contribution of the linear cost also shifts $\widetilde{P}$ by a constant.
}

Here one can use successive iterations to deal with the nonlinear term and various stability issues associated with convergence must be addressed. A simpler approach is, following [57], to note that the key role of the nonlinear term is to model portfolio capacity ${ }^{33}$ via its dependence on $I$, not its detailed structure in terms of individual alphas. In this regard, the following approximation is a reasonable way of simplifying the problem. Let
$$
\begin{align*}
\bar{\tau} & \equiv \frac{1}{N} \sum_{i=1} \tau_{i}  \tag{325}\\
\widetilde{\tau}_{i} & \equiv \tau_{i}-\bar{\tau} \tag{326}
\end{align*}
$$

\footnotetext{
${ }^{33}$ By this we mean the value of the investment level $I=I_{*}$ for which the $\mathrm{P} \& \mathrm{~L} P_{\mathrm{opt}}(I)$ is maximized, where for any given $I \mathrm{P} \& \mathrm{~L} P_{\mathrm{opt}}(I)$ is computed for the optimized weights $w_{i}$. When only linear cost is present, capacity is unbounded. When nonlinear cost is included, $I_{*}$ is finite.
}

If the distribution of $\widetilde{\tau}_{i}$ has a small standard deviation, then we can use the following approximation:
$$
\begin{align*}
& g(w, \mu, \widetilde{\mu}) \approx \frac{1}{2} \sum_{i, j=1}^{N} C_{i j} w_{i} w_{j}+\mu\left(\sum_{i=1}^{N}\left|w_{i}\right|-1\right)+ \\
& +\widetilde{\mu}\left[\sum_{i=1}^{N}\left(\alpha_{i} w_{i}-L_{i}\left|w_{i}\right|\right)-\frac{1}{n} \widetilde{Q}^{\prime}\left(\bar{\tau}^{n}+n \bar{\tau}^{n-1} \sum_{i=1}^{N} \widetilde{\tau}_{i}\left|w_{i}\right|\right)-\widetilde{P}\right] \tag{327}
\end{align*}
$$

The objective function can be rewritten as
$$
\begin{align*}
& g(w, \mu, \widetilde{\mu}) \approx \frac{1}{2} \sum_{i, j=1}^{N} C_{i j} w_{i} w_{j}+\mu\left(\sum_{i=1}^{N}\left|w_{i}\right|-1\right)+ \\
& \quad+\widetilde{\mu}\left(\sum_{i=1}^{N}\left(\alpha_{i} w_{i}-\widetilde{L}_{i}\left|w_{i}\right|\right)-\widetilde{P}^{\prime}\right) \tag{328}
\end{align*}
$$
where
$$
\begin{align*}
\widetilde{L}_{i} & \equiv L_{i}+\widetilde{Q}^{\prime} \bar{\tau}^{n-1} \tau_{i}=L_{i}+Q \rho_{*}^{n} I^{n-1} \bar{\tau}^{n-1} \tau_{i}  \tag{329}\\
\widetilde{P}^{\prime} & \equiv \widetilde{P}+\frac{1}{n} \widetilde{Q}^{\prime} \bar{\tau}^{n} \tag{330}
\end{align*}
$$
I.e., in this approximation the effect of the nonlinear term reduces to increasing the linear slippage and shifting $\widetilde{P}$, and this problem we can solve as in the previous section. Note, however, that the "effective" linear cost $\widetilde{L}_{i}$ now depends on the investment level $I$ via (329), which now controls capacity. Thus, for $I$ such that
$$
\begin{equation*}
\widetilde{L}_{i} \geq\left|\alpha_{i}\right| \tag{331}
\end{equation*}
$$
the $\mathrm{P} \& \mathrm{~L}$ cannot be positive. ${ }^{34}$

\footnotetext{
${ }^{34}$ The restriction on $I$ is even more severe, because this condition tells us that $\widetilde{P}^{\prime}$ cannot be positive, and for $\widetilde{P}$ to be positive, $\widetilde{L}_{i}$ would have to be even lower. At the end one is interested in determining capacity $I_{*}$, for which the optimized $\mathrm{P} \& \mathrm{~L}$ is maximized.
}

\section*{8 Comments}

Above, among other things, we discussed optimization where one maximizes P\&L subject to a lower bound on the Sharpe ratio. Theoretically this is a perfectly sound optimization problem. However, in practice it needs to be amended for the following reason. Realized return and expected return generally are vastly different. Because of this, the realized Sharpe ratio and the expected Sharpe ratio generally are also vastly different. For this reason, the condition $S \geq S_{\min }$ is impractical in terms of the realized Sharpe ratio as there is no natural way of setting realized $S_{\min }$, i.e., the lower bound on the realized Sharpe ratio. However, unlike the Sharpe ratio, portfolio risk $R$ is more stable and it makes sense to replace the condition $S \geq S_{\min }$ by $R \leq R_{\max }$. I.e., one now has the following optimization problem: $P \rightarrow \max$, $R \leq R_{\max }$, where the condition on $R$ can now be treated as a condition on expected risk. Happily, the actual solution to the latter optimization problem is the same as that discussed in Sections 5, 6 and 7, where now one specifies an upper bound on risk as opposed to a lower bound on the Sharpe ratio. The same applies to our discussion in Subsection 3.3.

One of our main points above is that using factor models for alpha streams substantially reduces the number of iterations in the optimization problem and renders it practically tractable. Using a constructed covariance matrix as opposed to the one computed based on the alpha time series also has the advantage that - assuming the factor covariance matrix is not computed using the very same time series - the factor model covariance matrix is expected to be more stable out-of-sample. Also, the number of nonzero eigenvalues in the computed covariance matrix is limited to $M \ll N$ (where $M+1$ is the number of observations - see Section 2), i.e., the number of risk factors (which are essentially based on principal components of the computed covariance matrix) is limited to $M$, whereas the constructed factor model covariance matrix can have many more risk factors as long as the factor covariance matrix $\Phi_{A B}$ is constructed based on stable data. Factor models for alpha streams is discussed in more detail in [60].

\section*{References}
[1] T. Schneeweis, R. Spurgin, and D. McCarthy, "Survivor Bias in Commodity Trading Advisor Performance", J. Futures Markets, 1996, 16(7), 757-772.
[2] C. Ackerman, R. McEnally and D. Revenscraft, "The Performance of Hedge Funds: Risk, Return and Incentives", Journal of Finance, 1999, 54(3), 833-874.
[3] S.J. Brown, W. Goetzmann and R.G. Ibbotson, "Offshore Hedge Funds: Survival and Performance, 1989-1995", Journal of Business, 1999, 72(1), 91-117.
[4] F.R. Edwards and J. Liew, "Managed Commodity Funds", Journal of Futures Markets, 1999, 19(4), 377-411.
[5] F.R. Edwards and J. Liew, "Hedge Funds versus Managed Futures as Asset Classes", Journal of Derivatives, 1999, 6(4), 45-64.
[6] W. Fung and D. Hsieh, "A Primer on Hedge Funds", Journal of Empirical Finance, 1999, 6(3), 309-331.
[7] B. Liang, "On the Performance of Hedge Funds", Financial Analysts Journal, 1999, 55(4), 72-85.
[8] V. Agarwal and N.Y. Naik, "On Taking the "Alternative" Route: The Risks, Rewards, and Performance Persistence of Hedge Funds", Journal of Alternative Investments, 2000, 2(4), 6-23.
[9] V. Agarwal and N.Y. Naik, "Multi-Period Performance Persistence Analysis of Hedge Funds Source", Journal of Financial and Quantitative Analysis, 2000, 35(3), 327-342.
[10] W. Fung and D. Hsieh, "Performance Characteristics of Hedge Funds and Commodity Funds: Natural vs. Spurious Biases", Journal of Financial and Quantitative Analysis, 2000, 35(3), 291-307.
[11] B. Liang, "Hedge Funds: The Living and the Dead", Journal of Financial and Quantitative Analysis, 2000, 35(3), 309-326.
[12] C.S. Asness, R.J. Krail, and J.M. Liew, "Do Hedge Funds Hedge?", Journal of Portfolio Management, 2001, 28(1), 6-19.
[13] F.R. Edwards and M.O. Caglayan, "Hedge Fund and Commodity Fund Investments in Bull and Bear Markets", Journal of Portfolio Management, 2001, 27(4), 97-108.
[14] W. Fung and D. Hsieh, "The Risk in Hedge Fund Strategies: Theory and Evidence from Trend Followers", Review of Financial Studies, 2001, 14(2), 313341.
[15] B. Liang, "Hedge Fund Performance: 1990-1999", Financial Analysts Journal, 2001, 57(1), 11-18.
[16] A.W. Lo, "Risk Management For Hedge Funds: Introduction and Overview", Financial Analysis Journal, 2001, 57(6), 16-33.
[17] C. Brooks and H.M. Kat, "The Statistical Properties of Hedge Fund Index Returns and Their Implications for Investors", Journal of Alternative Investments, 2002, 5(2), 26-44.
[18] D.-L. Kao, "Battle for Alphas: Hedge Funds versus Long-Only Portfolios", Financial Analysts Journal, 2002, 58(2), 16-36.
[19] G. Amin and H. Kat, "Stocks, Bonds and Hedge Funds: Not a Free Lunch!", Journal of Portfolio Management, 2003, 29(4), 113-120.
[20] N. Chan, M. Getmansky, S.M. Haas and A.W. Lo, "Systemic Risk and Hedge Funds", published in: Carey, M. and Stulz, R.M., eds., "The Risks of Financial Institutions" (University of Chicago Press, 2006), Chapter 6, 235-338.
[21] Z. Kakushadze and J.K.-S. Liew, "Is It Possible to OD on Alpha?", The Journal of Alternative Investments (forthcoming); http://ssrn.com/abstract=2419415.
[22] H. Markowitz, "Portfolio selection", Journal of Finance, 1952, 7(1), 77-91.
[23] A. Charnes and W.W. Cooper, "Programming with linear fractional functionals", Naval Research Logistics Quarterly, 1962, 9(3-4), 181-186.
[24] W.F. Sharpe, "Mutual fund performance", Journal of Business, 1966, 39(1), 119-138.
[25] R.C. Merton, "Lifetime portfolio selection under uncertainty: the continuous time case", The Review of Economics and Statistics, 1969, 51(3), 247-257.
[26] S. Schaible, "Parameter-free convex equivalent and dual programs of fractional programming problems", Zeitschrift für Operations Research, 1974, 18(5), 187196.
[27] M. Magill and G. Constantinides, "Portfolio selection with transactions costs", J. Econom. Theory, 1976, 13(2), 245-263.
[28] A.F. Perold, "Large-scale portfolio optimization", Management Science, 1984, 30(10), 1143-1160.
[29] M. Davis and A. Norman, "Portfolio selection with transaction costs", Math. Oper. Res., 1990, 15(4), 676-713.
[30] B. Dumas and E. Luciano, "An exact solution to a dynamic portfolio choice problem under transaction costs", The Journal of Finance, 1991, 46(2), 577-595.
[31] C. J. Adcock and N. Meade "A simple algorithm to incorporate transactions costs in quadratic optimization", European Journal of Operational Research, 1994, 79(1), 85-94.
[32] S. Shreve and H.M. Soner, "Optimal investment and consumption with transaction costs", Ann. Appl. Probab., 1994, 4(3), 609-692.
[33] D. Bienstock, "Computational study of a family of mixed-integer quadratic programming problems", Mathematical Programming, 1996, 74(2), 121-140.
[34] J. Cvitanić and I. Karatzas, "Hedging and portfolio optimization under transaction costs: a martingale approach", Math. Finance, 1996, 6(2), 133-165.
[35] A. Yoshimoto, "The mean-variance approach to portfolio optimization subject to transaction costs", J. Operations Research Soc. of Japan, 1996, 39(1), 99-117.
[36] C. Atkinson, S.R. Pliska and P. Wilmott, "Portfolio management with transaction costs", Proc. Roy. Soc. London Ser. A, 1997, 453(1958), 551-562.
[37] D. Bertsimas, C. Darnell and R. Soucy, "Portfolio construction through mixedinteger programming at Grantham, Mayo, Van Otterloo and Company", Interfaces, 1999, 29(1), 49-66.
[38] A. Cadenillas and S. R. Pliska, "Optimal trading of a security when there are taxes and transaction costs", Finance and Stochastics, 1999, 3(2), 137-165.
[39] T.-J. Chang, N. Meade, J.E. Beasley and Y.M. Sharaiha, "Heuristics for cardinality constrained portfolio optimisation", Computers and Operations Research, 2000, 27(13), 1271-1302.
[40] H. Kellerer, R. Mansini and M.G. Speranza, "Selecting portfolios with fixed costs and minimum transaction lots", Annals of Operations Research, 2000, 99(1-4), 287-304.
[41] R.T. Rockafellar and S. Uryasev, "Optimization of conditional value-at-risk", Journal of Risk, 2000, 2(3), 21-41.
[42] J. Gondzio and R. Kouwenberg, "High-performance computing for assetliability management", Operations Research, 2001, 49(6), 879-891.
[43] H. Konno and A. Wijayanayake, "Portfolio optimization problem under concave transaction costs and minimal transaction unit constraints", Mathematical Programming, 2001, 89(2), 233-250.
[44] S. Mokkhavesa and C. Atkinson, "Perturbation solution of optimal portfolio theory with transaction costs for any utility function", IMA J. Manag. Math., 2002, 13(2), 131-151.
[45] O.L.V. Costa and A.C. Paiva, "Robust portfolio selection using linear-matrix inequalities", Journal of Economic Dynamics and Control, 2002, 26(6), 889-909.
[46] F. Alizadeh and D. Goldfarb, "Second-order cone programming", Mathematical Programming, 2003, 95(1), 3-51.
[47] M.J. Best and J. Hlouskova, "Portfolio selection and transactions costs", Computational Optimization and Applications, 2003, 24(1), 95-116.
[48] K. Janeček and S. Shreve, "Asymptotic analysis for optimal investment and consumption with transaction costs", Finance Stoch., 2004, 8(2), 181-206.
[49] M.S. Lobo, M. Fazel and S. Boyd, "Portfolio optimization with linear and fixed transaction costs", Annals of Operations Research, 2007, 152(1), 341-365.
[50] R. Zagst and D. Kalin, "Portfolio optimization under liquidity costs", International Journal of Pure and Applied Mathematics, 2007, 39(2), 217-233.
[51] M. Potaptchik, L. Tunçel and H. Wolkowicz, "Large scale portfolio optimization with piecewise linear transaction costs", Optimization Methods and Software, 2008, 23(6), 929-952.
[52] E. Moro, J. Vicente, L.G. Moyano, A. Gerig, J.D. Farmer, G. Vaglica, F. Lillo and R.N. Mantegna, "Market impact and trading profile of hidden orders in stock markets", Physical Review E, 2009, 80, 066102.
[53] J. Goodman and D.N. Ostrov, "Balancing small transaction costs with loss of optimal allocation in dynamic stock trading strategies", SIAM J. Appl. Math., 2010, 70(6), 1977-1998.
[54] M. Bichuch, "Asymptotic analysis for optimal investment in finite time with transaction costs", SIAM J. Financial Math., 2012, 3(1), 433-458.
[55] J.E. Mitchell and S. Braun, "Rebalancing an investment portfolio in the presence of convex transaction costs, including market impact costs", Optimization Methods and Software, 2013, 28(3), 523-542.
[56] H. Soner and N. Touzi, "Homogenization and asymptotics for small transaction costs", SIAM Journal on Control and Optimization, 2013, 51(4), 2893-2921.
[57] Z. Kakushadze, "Combining Alpha Streams with Costs", The Journal of Risk, 2015, 17(3), 57-78; http://ssrn.com/abstract=2438687; arXiv:1405.4716
[58] Z. Kakushadze, "Spectral Model of Turnover Reduction", SSRN Working Paper, http://ssrn.com/abstract=2427049; arXiv:1404.5050.
[59] R. Rebonato and P. Jäckel, "The most general methodology to create a valid correlation matrix for risk management and option pricing purposes" (1999), http://ssrn.com/abstract=1969689 (December 7, 2011).
[60] Z. Kakushadze, "Factor Models for Alpha Streams", The Journal of Investment Strategies, 2014, 4(1), 83-109; http://ssrn.com/abstract=2449927; arXiv:1406.3396 [q-fin.PM].
